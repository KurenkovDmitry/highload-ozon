<div style="text-align: center;">

# highload-ozon

## Расчетно-пояснительная записка
<span style="display: block; margin-top: -15px; font-size: 1.2em;">
по курсовой работе на тему 
<span style="display: inline-block; min-width: min-content;">«Проектирование высоконагруженных систем»</span>
</span>

</div>

**Студент:** Куренков Дмитрий  
**Группа:** WEB-31  
**Курс:** Технопарк (VK и МГТУ им. Н.Э. Баумана)

В рамках данной работы рассматривается проектирование архитектуры интернет-магазина, подобного Ozon, с учётом высоких нагрузок, масштабируемости и обеспечения отказоустойчивости системы.

Целевая аудитория включает:
- **Покупателей:** конечные пользователи, для которых важны удобство поиска, детальная информация о товарах, прозрачный процесс оформления заказа и оперативная доставка.
- **Продавцов:** компании и индивидуальные предприниматели, желающие продавать товары через онлайн-платформу.
- **Технические специалисты:** разработчики и системные администраторы, ответственные за поддержание высоконагруженной инфраструктуры.


---

## Содержание

1. [Тема и целевая аудитория](#тема-и-целевая-аудитория)
2. [Расчет нагрузки](#расчет-нагрузки)
3. [Глобальная балансировка нагрузки](#глобальная-балансировка-нагрузки)
4. [Локальная балансировка нагрузки](#локальная-балансировка-нагрузки)
5. [Логическая схема БД](#логическая-схема-бд)
6. [Физическая схема БД](#физическая-схема-бд)
7. [Алгоритмы](#алгоритмы)
8. [Технологии](#технологии)
9. [Обеспечение надёжности](#обеспечение-надёжности)
10. [Схема проекта](#схема-проекта)
11. [Список серверов](#список-серверов)
12. [Список источников](#список-источников)

---

## 1. Тема и целевая аудитория <a name="тема-и-целевая-аудитория"></a>

### Тема:

Ozon – один из ведущих российских маркетплейсов, основанный в 1998 году как интернет-магазин книг и видеокассет. Сегодня платформа предлагает широкий ассортимент товаров — от одежды и электроники до товаров для дома — и развивает дополнительные сервисы, такие как:

- **Ozon Fresh:** экспресс-доставка товаров повседневного спроса.
- **Ozon Банк:** финансовые сервисы для покупателей и продавцов.
- **Ozon Travel:** бронирование авиа- и железнодорожных билетов, отелей и туров.

Ozon использует собственную логистическую инфраструктуру и сотрудничает с тысячами продавцов, что позволяет обслуживать десятки миллионов покупателей как в России, так и в ряде зарубежных стран. [^2]

В условиях курсовой работы будет взята небольшая часть продукта (mvp), которую рассмотрим ниже.

### Функциональные требования (MVP):

Для реализации минимально жизнеспособного продукта (MVP) интернет-магазина целесообразно включить следующие функции:

1. **Работа с товарами (просмотр, детализация, отзывы, поиск)**
   - Функционал поиска товаров.
   - Функционал фильтра товаров (корректирует ленту выводимых товаров (как сами товары, так и их порядок)). (по цене, по категориям, по популярности, по дате добавления, по весу)
   - Подробное описание товара, включая цену, характеристики, изображения и отзывы.
   - Категории товаров
   - Главная страница с товарами (связь с пунктом 2, вывод на основе рекомендательной системы)

2. **Рекомендательная система**
   - Динамическая лента товаров, подстраивающаяся под пользователей.

3. **Отзывы**
   - Добавление (по одному за каждую покупку), редактирование, удаление, просмотр

4. **Корзина**
    - Добавление, удаление и изменение количества товаров, а также указание адреса доставки.

5. **Оформление заказа (базовое)**
    - Выбор способа оплаты (можно оставить для начала 1, но заложить, что их несколько) и доставки (можно оставить для начала 1, но заложить, что их несколько), подтверждение заказа.

6. **Работа с заказами**
   - Просмотр истории, просмотр деталей (страница заказа), просмотр статуса (получен товар или нет).

7. **Пользователь (авторизация/регистрация, личный кабинет)**
    - Личный кабинет для просмотра истории заказов и управления персональными данными.

8. **Личный кабинет продавца**
    - Функционал размещения товаров на платформе (опционально для расширения MVP).
    - Управление ценами и другими данными по выставленным товарам и заказами

Фичи:

1. **Интеграция способов оплаты**
   - Подключение платежных систем (карты, электронные кошельки). 
   - Возможность оплаты при получении.

2. **Отслеживание заказа (трекинг)**
   - Интеграция с логистическими сервисами для мониторинга статуса доставки.

3. **Вам может понравиться**
   - На основе рекомендательной системы для товара - товары которые могут заинтересовать пользователя на странице просматриваемого товара.

> **Комментарий:**  
> Данный набор функций охватывает основные сценарии использования интернет-магазина. Для MVP достаточно реализовать ключевые функции, связанные с составлением, оформлением и отслеживанием заказа. Если планируется дальнейшее развитие платформы, можно дополнительно включить личный кабинет для продавцов и расширенную интеграцию с логистическими системами.

> **Комментарий:**  
> Стоит отметить, что необязательным для mvp, но очень рекомендуемым для пользовательского опыта была бы реализация загрузки материала (например карточек товара или отзывов) до того, как это понадобится пользователю, отметая время которое он бы ждал, когда ему захочется увидеть ещё товаров.

---

### Целевая аудитория и анализ веб-трафика

**Целевая аудитория Ozon:**

- **Покупатели:** пользователи, ценящие удобство онлайн-шопинга, широкий ассортимент и оперативную доставку.
- **Продавцы:** компании, желающие расширить свои каналы сбыта через маркетплейс.
- **Технические специалисты:** разработчики и системные администраторы, ответственные за поддержание высоконагруженной инфраструктуры.

**Анализ веб-трафика (для января 2025-ого):**

- **Общее количество визитов:** 436.7 млн [^1]
- **Изменение за последний месяц:** -5.96% [^1]
- **Количество активных покупателей (среднее за первую половину 2024-ого)** 51.1 миллион пользователей [^3]
- **Процент отказов:** 26.42% [^1]
- **Количество страниц за визит:** 11.16 [^1]
- **Средняя продолжительность визита:** 00:08:58 [^1]
- **Количество заказов (3-ий квартал 2024-ого):** 371,5 млн (подобные значения можно отследить и ранее) [^4], [^8]
- **Активные покупатели (3-ий квартал 2024-ого):** >53 млн (подобные значения можно отследить и ранее) [^4], [^5], [^8]
- **Активные продавцы (3-ий квартал 2024-ого):** >550 тыс [^5]

**Географическое распределение:** [^1]

- **Россия:** 95.46% (основной источник трафика, преимущественно с настольных компьютеров)
- Другие страны: Беларусь, Казахстан, Кыргызстан, Армения, Китай, Турция и т.д. [^8]

![img_1.png](img/1/img_1.png)

(данные по similarweb) [^1]
- **Россия:** 95.46%
- **Беларусь:** 0.6%
- **Германия:** 0.5%
- **Украина:** 0.49%
- **Казахстан:** 0.43%
- **Другие:** 2.53%

**Демографические показатели (за январь 2025-ого similarweb):** [^1]

- **Пол:** 61.85% мужчин и 38.15% женщин
- **Возраст:** наиболее многочисленная группа — 25–34 года

![img_2.png](img/1/img_2.png)

По данным retail за 2024 (исследование Tinkoff Data): [^6]

- **Пол продавцов:** 49% мужчин и 51% женщин

**Сравнительный анализ по предыдущим периодам:**
- **За 1 квартал 2024 года:** активные покупатели составляли около 49 млн, а частота заказов — 22 заказа в год. [^7]
- **За 3 квартал 2024 года:** зафиксирован рост активных покупателей до >53 млн и увеличение количества заказов до 371.5 млн. [^4], [^5]
- **Динамика:** эти данные демонстрируют устойчивый рост аудитории и увеличивающуюся вовлеченность пользователей за последние кварталы.

---

## 2. Расчет нагрузки <a name="расчет-нагрузки"></a>

**Данные по годам (2023 и 2024):**

Таблица 1 - данные по кварталам 2023 года

| Квартал 2023-ого             | Активные покупатели (млн) | Количество заказов (млн) | Активные продавцы (тыс)     | Частота заказов в год |
|------------------------------|---------------------------|--------------------------|-----------------------------|-----------------------|
| 1 [^15], [^16]               | ~37                       | ~179,3                   | x                           | ~15                   |
| 2 [^14]                      | ~39,5                     | ~209                     | x                           | ~17                   |
| 3 [^12], [^13]               | ~42                       | ~251                     | \>36 (пользователи Fintech) | ~19                   |
| 4 [^11], [^12], [^14], [^15] | ~46,1                     | ~326,7                   | x                           | ~21                   |

Таблица 2 - данные по кварталам 2024 года

| Квартал 2024-ого | Активные покупатели (млн) | Количество заказов (млн) | Активные продавцы (тыс) | Частота заказов в год |
|------------------|---------------------------|--------------------------|-------------------------|-----------------------|
| 1 [^10]          | ~49                       | ~305                     | ~500                    | ~22                   |
| 2 [^9]           | ~51,1                     | ~335                     | x                       | ~24                   |
| 3 [^5], [^4]     | ~53,5                     | ~371,5                   | \>550                   | ~25                   |
| 4                | x                         | x                        | x                       | x                     |


**На основе этих данных можно примерно оценить MAU и DAU, а также другие продуктовые метрики:**

*Квартал = 3-ем месяцам:*
- 1-ый квартал - январь, февраль, март, поэтому 31+28+31=90 дней (в 2024 - 91 день)
- 2-ой квартал - апрель, май, июнь, поэтому 30+31+30=91 дней
- 3-ий квартал - июль, август, сентябрь, поэтому 31+31+30=92 дня
- 4-ий квартал - октябрь, ноябрь, декабрь, поэтому 31+30+31=92 дня

Обозначим:
- Средний размер хранилища пользователя в штуках и гигабайтах (по типам, там где существенно) -- СРХП
- Среднее количество действий пользователя -- СКДП 

*Рассмотрим данные необходимые для примерной оценки этих значений, оценим MAU и DAU:*

Рассмотрим получение MAU 2-мя способами и сопоставим их получив более менее точное значение:
- Воспользуемся сервисом Pr-Cy [^17] для примерной оценки MAU, который более точен, чем его аналоги SimilarWeb и Be1.
- Возьмем WAU основываясь на данных со страницы продавцов [^18] по посетителям за последние 7 дней и рассчитаем относительно этих данных и данным из финансовых отчетов примерное значение MAU.

***Данные от Pr-Cy***

![img_1.png](img%2F2%2Fimg_1.png)

(Для пользователей, так что вычитаем отказы)

MAU ≈ 323.2M

Однако с учетом того, что не все эти пользователи - активные (совершают действие покупки), переоценим это через отношения за известные периоды времени

![img_2.png](img%2F2%2Fimg_2.png)

![img_3.png](img%2F2%2Fimg_3.png)

![img_4.png](img%2F2%2Fimg_4.png)

Тогда за 3-ий квартал 2024 примерно 304,12 млн. (410,97 за вычетом 26% отказов), а активных из них по таблице 2 - 53,5 млн., что есть  примерно 17,59%.
Для продавцов (по таблице 2 их 550 тыс.) это примерно 0,2%

Сделаем то же самое для 2-ого квартала:

![img_5.png](img%2F2%2Fimg_5.png)

![img_6.png](img%2F2%2Fimg_6.png)

![img_7.png](img%2F2%2Fimg_7.png)

Тогда за 2-ой квартал 2024 примерно 281,64 млн., а активных из них по таблице 2 - 51,1 млн., что есть 18,14%.
Для продавцов (по таблице 2 можем предположить, что их примерно 525 тыс.) это примерно 0,2%

Экстраполяция: активные пользователи (которые заказывают) ≈ 18% от общего числа, а продавцы и то всего 0,2%.

Тогда получаем, что MAU ≈ 58,176 млн.

***Данные по отчетам Ozon и математическим приблизительным расчетам***

По данным от 12.02.2025 18:07 WAU от сайта для продавцов: [^18]

![img.png](img%2F2%2Fimg.png)

WAU примем равным за 45276595, что примерно равно 45,28 млн.

Теперь проведем примерную оценку данных для четвертого квартала, основываясь на данных из таблиц 3 и 4.

*Активные покупатели (млн)*

- Тренд роста в 2023: линейный с ускорением в Q4 (+4.1 млн).
- В 2024 квартальный прирост: ~2.47 млн (среднее за 2024).
- Учет сезонности 2023: предполагаем дополнительный прирост +1.6 млн.

$$
Q4_{2024} = Q3_{2024} + \text{средний прирост} + \text{сезонная поправка} = 53.5 + 2.47 + 1.6 \approx 57.6 \text{ млн}
$$

Погрешность: ±2 млн (возможное замедление роста).

*Количество заказов (млн)*

- В 2023 рост ускорялся: +29.7 → +42 → +75.7 (Q4). 
- В 2024 прирост: +30 → +36.5.

Примерно значения прироста не отличаются, таким образом можем предположить прирост +75,7:

$$
Q4_{2024} = Q3_{2024} + \text{прирост} = 371,5 + 75.7 = 447,2 \text{ млн}
$$

Таким образом средние и проценты погрешностей: +29,85 (0,5%) → +39,25 (7%), таким образом примерная погрешность 3,5%, что есть 2,6595 млн, что примерно 2,7 млн

Погрешность: ±2,7 млн (риск насыщения рынка).

*Активные продавцы (тыс)*

- В 2024 рост: +50 тыс за два квартала (Q1–Q3).
- Экстраполяция: +25 тыс/квартал → Q4 = 550 + 25 = 575 тыс.

Погрешность: ±12.5 млн.

*Частота заказов в год*

- В 2023: +2 за квартал.
- В 2024: замедление до +1 в Q3 (разовый). Предполагаем +2 в Q4.

$$
Q4_{2024} = Q3_{2024} + 2 = 25 + 2 = 27 
$$

Погрешность: ±1 (риск изменения поведения пользователей).

Таким образом:

Таблица 3 - итоговая таблица прогноза

| Квартал 2024-ого | Активные покупатели (млн) | Количество заказов (млн) | Активные продавцы (тыс) | Частота заказов в год |
|------------------|---------------------------|--------------------------|-------------------------|-----------------------|
| 4                | ~57.6 ± 2                 | ~447,2 ± 2,7             | ~575 ± 12.5             | ~27 ± 1               |

Введем в расчет, что MAU приблизительно совпадает с данными за квартал, но для строгости расчетов возьмем его значение как 98%, таким образом MAU покупателей ≈ 56,4 ± 1,96 млн., а продавцов ≈ 563 +- 12,25 тыс.

Таким образом мы рассчитали, что MAU, полученный из pr-cy, вошел в диапазон рассчитанных значений методом 2, тем самым мы можем предположить, что данные можно взять за верное значение, таким образом обозначив значения MAU, а также, основываясь на предшествующих вычислениях, рассчитать их примерные значения для продавцов, обычных посетителей и пользователей:

Для расчета DAU, введем предположение относительного соотношения Sticky Factor, который относительно можно взять неизменяемым и взять равным 36% на основе исследований mediascope. [^19]

Таблица 4 - MAU, DAU для покупателей, продавцов, пользователей и посетителей

| Пользователи | MAU (млн) | DAU (млн) |
|--------------|-----------|-----------|
| Покупатели   | 58,18     | 20,94     |
| Продавцы     | 0,64      | 0,23      |
| Пользователи | 323,2     | 116,35    |
| Посетители   | 436,7     | 157,21    |

Тут:
- Покупатели - те кто покупают
- Продавцы - те кто продают
- Пользователи - те кто зашли не ошибившись сайтом (примерный расчет на основе быстрого выхода пользователей)
- Посетители - все посетившие сайт

Теперь оценим СРХП и СКДП:

***СКДП:***

**Рассмотрим для покупателей**

По таблице 3 можно определить количество заказов в день, а именно делением 27 на количество дней в Q4, то есть 27 / 92 = 0,29 заказа в день.

По статье от 6 декабря 2024 поисковых запросов в месяц примерно 1,007 млрд. [^20]

Тогда мы можем оценить сколько раз в день пользователь пользуется поиском: 1007 млн. / 30 (количество дней) / 20,94 млн. (DAU) ≈ 1,6 запрос в сутки

На основе таблицы 2 и MAU через данные за кварталы оценим примерно прирост покупателей, который составляет 58,176 - 53,5 = 4,676 млн. Тогда в среднем в сутки регистрировалось 4,676 / 92 (количество дней в Q4) ≈ 0,05 млн. 

В среднем пользователи просматривают историю заказов 2,5 раза, 1 - при составлении, 1 во время окончания для проверки доставки и ещё 1 допустим для доказательства принадлежности товара, тогда это значение равно 0,29 * 2,5 = 0,725.

Проведем оценку количества блочных загрузок (по 5 товаров) необходимых для нахождения понравившегося товара, для этого учтем, что согласно Hick’s Law время принятия решения растет с увеличением количества вариантов. Однако Ozon использует персонализированные рекомендации и фильтры, которые сокращают выбор до релевантных товаров. На основе этих данных можно примерно оценить необходимость 4-8 загрузок, чтобы найти, то, за что зацепится взгляд, так как при большем количестве время принятия решения сильно увеличится, а меньше зачастую недостаточно. Из этих 30 покупатель рассмотрят примерно 9 товаров.

На основе того что по статистике примерно 50% покупателей посещают ежедневно, а 80% покупателей раз в месяц мы можем примерно оценить среднее значение ежедневного посещения покупателем сайта и он равен 0,5 * 1 + (0,8 - 0,5) * 0,3 + ~0 = 0,51 запрос в сутки [^22]

Тогда ежедневно просмотр товаров = 9 * 0,51 = 4,59 запросов в сутки, а просматриваемых страниц и то 5 * 0,51 = 2,55 запросов в сутки

На основе анализа e-promo для продукта EliteCat [^21] можно оценить количество добавлений в корзину до продвижения и после, тем самым пусть и примерно оценить верхнюю и нижнюю границы, таким образом взяв за среднее получим необходимое процентное отношение просматриваемых товаров и добавлений в корзину: после продвижения (max) процент - 0,4%, а так как до этого было в 1,5 раза меньше, то min - 0,27%, тогда среднее значение примерно 0,34%.

Тогда в корзину добавляется примерно 0,34 * 2,55 ≈ 0,87 запросов в сутки. А вот изменение зачастую не выполняется, так что стремится к 0, но не является им, поэтому приблизительно возьмем 0,01 запрос в сутки.

Оценим отзывы - они подгружаются по 10, что зачастую достаточно для пользователя, максимум - 20, таким образом необходимо в среднем около 1,5 блочных загрузок отзывов. Тогда загрузок в сутки будет 1,5 * 2,55, что есть 3,83 загрузок в сутки.

За раз Ozon старается загрузить как модно раз прогрузку товаров, как и комментарии, поэтому возьмем примерное значение, которое он успевает прогрузить примерно 25 раз.

С комментариями аналогичная ситуация, пока пользователь читает (товар либо комментарии), в среднем успевает загрузится около 10 итераций.

Из статьи [^23] можно выделить что на WB оставляют около 200 тыс. отзывов, а т.к. WB по нагрузке близок к Ozon, то эти данные будут примерно совпадать, но это статья от 2022 года, а количество активных покупателей по сопоставлению финансовых отчетов [^24] и MAU нынешнем, можно оценить из того, что количество активных пользователей выросло с 30,7 млн. до 58,18 млн., а следовательно и отзывов ежедневно не 200 тыс., а примерно 379022,8. Можем рассчитать сколько ежедневно оставляет отзывов 1 пользователь и это число 379022,8 / 58180000 ≈ 0,0065 отзывов в сутки

Просмотр корзины примерно совпадает с оформлением.

На основе этих данных заполним таблицу

Таблица 5 - Оценка СКДП (покупатели)

| Оцениваемое                                        | Значение (запросов в сутки) для пользователя |
|----------------------------------------------------|----------------------------------------------|
| Просмотр товаров (по 5)                            | 4,59                                         |
| Прогрузка товаров (по 5)                           | 12,75                                        |
| Использование поиска (количество блочных загрузок) | 1,6                                          |
| Просмотр страницы товаров                          | 2,55                                         |
| Просмотр отзывов (по 10)                           | 3,83                                         |
| Работа с отзывами (добавление)                     | 0,0065                                       |
| Прогрузка отзывов (по 10)                          | 10,2                                         |
| Работа с корзиной (добавление)                     | 0,87                                         |
| Работа с корзиной (редактирование)                 | 0,01                                         |
| Просмотр истории заказов                           | 0,725                                        |
| Заказ (Оформление)                                 | 0,29                                         |
| Просмотр корзины                                   | 0,29                                         |

**Рассмотрим для продавцов**

> **Комментарий:**  
> Так как точные данные компания не распространяет о количестве товаров (нигде не указывается четкое общее число), то можем лишь примерно оценить на основе финансовых отчетов указанных ранее и чата, в котором периодически идут ссылки на количество товаров на складе [^25]

Таблица 6 - Оценка СКДП (продавцы)

| Оцениваемое                   | Значение (запросов в сутки) для пользователя |
|-------------------------------|----------------------------------------------|
| Выставление товара на продажу | 0,5                                          |

**Рассмотрим для пользователей**

Так как доступные функции для неавторизованных пользователей используются так же как для авторизованных, то на основе таблицы 5 можно заполнить поля "Просмотр товаров (по 5)", "Использование поиска (количество блочных загрузок)", "Просмотр страницы товаров", "Просмотр отзывов (по 10)", "Работа с отзывами (добавление)", "Работа с корзиной (добавление)", "Работа с корзиной (редактирование)".

Из таблицы 4 видно, что покупатели - 18% от посетителей, тогда можем оценить функции доступные только для авторизованных - "Просмотр истории заказов" и "Заказ", которые будут равны 18% от значений в таблице 5

Таблица 7 - Оценка СКДП (пользователи)

| Оцениваемое                                        | Значение (запросов в сутки) для пользователя |
|----------------------------------------------------|----------------------------------------------|
| Просмотр товаров (по 5)                            | 4,59                                         |
| Прогрузка товаров (по 5)                           | 12,75                                        |
| Использование поиска (количество блочных загрузок) | 1,6                                          |
| Просмотр страницы товаров                          | 2,55                                         |
| Просмотр отзывов (по 10)                           | 3,83                                         |
| Работа с отзывами (добавление)                     | 0,0065                                       |
| Прогрузка отзывов (по 10)                          | 10,2                                         |
| Работа с корзиной (добавление)                     | 0,87                                         |
| Работа с корзиной (редактирование)                 | 0,01                                         |
| Просмотр истории заказов                           | 0,13                                         |
| Заказ (Оформление)                                 | 0,05                                         |
| Просмотр корзины                                   | 0,05                                         |

**Рассмотрим для посетителей**

Для посетителей будем основываться на таблицу 7, добавив в учет то, что по той таблице работаю только 74% посетителей, остальные же лишь около 5 раз прогружают просмотр товаров, так как оно автоматически запускается при заходе.

Тогда для всего кроме "Прогрузка товаров (по 5)" можно получить примерное значение путем умножения значения из таблицы 7 на 0,74.

А "Прогрузка товаров (по 5)" есть 12,75 * 0,74 + 5 * 0,26 = 9,435 + 1,3 ≈ 10,74

Таблица 8 - Оценка СКДП (посетители)

| Оцениваемое                                        | Значение (запросов в сутки) для пользователя |
|----------------------------------------------------|----------------------------------------------|
| Просмотр товаров (по 5)                            | 3,40                                         |
| Прогрузка товаров (по 5)                           | 10,74                                        |
| Использование поиска (количество блочных загрузок) | 1,18                                         |
| Просмотр страницы товаров                          | 1,89                                         |
| Просмотр отзывов (по 10)                           | 2,83                                         |
| Работа с отзывами (добавление)                     | 0,0048                                       |
| Прогрузка отзывов (по 10)                          | 7,55                                         |
| Работа с корзиной (добавление)                     | 0,64                                         |
| Работа с корзиной (редактирование)                 | 0,01                                         |
| Просмотр истории заказов                           | 0,10                                         |
| Заказ (Оформление)                                 | 0,04                                         |
| Просмотр корзины                                   | 0,04                                         |

***СРХП:***

**Для покупателя необходимо хранить**

> **Комментарий:**  
> Проведем примерную оценку, точное число будет зависеть от применяемых технологий хранения информации. 

> **Комментарий:**  
> Оцениваем только большие данные (например медиа либо большие тексты)

Для пользователя:

Важно рассчитать параметры:
- по таблице 6 можно увидеть, что продавец выставляет на продажу товар 0,5 раз в сутки, получается, что за год он примерно выставит на продажу 182 товара, а за 3 - 546, возьмем это значения как среднее.
- теперь учтем то, что по таблице 3 продавцы, которые в преобладающей степени ещё и покупатели есть только примерно 1%, то есть среднее количество товаров выставленных на продажи для этой группы будет 5,46.

Нужно хранить аватарку (18 килобайт), идентификаторы товаров (16 * 5,46 = 87,36 байт), таким образом в среднем занимаемый объем ≈ 18 * 1024 + 87,36 байт ≈ 18 килобайт

Для заказа: 

Важно рассчитать параметры:
- по таблице 5 можно увидеть, что заказ производится 0,29 раз в сутки, а вот добавление в корзину 0,87, тогда опустив погрешность удаляемых товаров из корзины (мало, поэтому имеем права опустить при вычислении приблизительного значения) можно рассчитать среднее количество товаров в одном закате и это примерно 1 / 0,29 * 0,87 = 3 товара

Идентификатор (16 байт), дата заказа (8 байт), дата доставки (8 байт), адрес доставки (90 байт - 45 символов), адрес откуда товар (90 байт - 45 символов), идентификатор покупателя (16 байт), статус (2 байта), список товаров (3 * 16 = 48 байт), цену (4 байта), таким образом в среднем занимаемый объем ≈ 16 + 8 + 8 + 90 + 90 + 16 + 2 + 48 + 4 = 282 байт.

Для товара:

Характеристики (2 килобайта), описание (2,5 килобайта), несколько фотографий (7 * 20 = 140 килобайт), список идентификаторов отзывов (32 килобайта), таким образом в среднем занимаемый объем ≈ 2 + 2,5 + 140 + 32 = 176,5 кбайт 

Отзыв:

Идентификатор (16 байт), идентификатор пользователя (16 байт), отзыв (100 байт - 50 символов), таким образом в среднем занимаемый объем ≈ 16 + 16 + 100 = 132 байта

Теперь после получение одинарных значений, оценим данные для Q4 2024, сколько примерно памяти нужно, чтобы потянуть оцененную выше нагрузку.

Начнем с пользователей, которых 58,18 млн., тогда объем для их хранения примерно 18 / 1024 / 1024 * 58,18 * 10^(6) ≈ 998,7 гигабайт, а прирост за месяц - 18 / 1024 / 1024 * (58,18 - 53,5) * 10^(6) ≈ 80,34 гигабайт

По таблице 5 каждый покупатель совершает в среднем 0,29 заказа в сутки, тогда в месяц это примерно 8,7 заказа, а если учесть необходимый объём памяти для одного заказа и количество покупателей, то получаем, что нужно 8,7 * 58,18 * 10^(6) * 0,00000026 = 131,6 гигабайт.

А вот уже по 6 таблице каждый продавец выставляет пол товара в сутки (в среднем), а если ещё взять под расчет, то что по таблице 3 продавцов 575 тыс., то за месяц товары займут 575 * 10^(3) * 0,5 * 30 * 0,0,00013971 = 1204,999 гигабайт.

По таблице 5 мы видим, что покупатель в среднем оставляет 0,0065 отзывов в сутки, тогда в месяц это будет 0,195, а для все покупателей 11345100 отзывов, тогда занимаемый ими объем ≈ 11345100 * 0,00000012 ≈ 1,36 гигабайт.

Таблица 9 - Оценка СРХП (покупатели)

| Оцениваемое           | размер хранилища в гигабайтах |
|-----------------------|-------------------------------|
| 1 пользователь        | 0,00001717                    |
| 1 заказ               | 0,00000026                    |
| 1 товар               | 0,00013971                    |
| 1 отзыв               | 0,00000012                    |
| покупатели            | 998,7                         |
| покупатели (за месяц) | 80,34                         |
| заказы (за месяц)     | 131,6                         |
| товары (за месяц)     | 1204,99                       |
| отзывы (за месяц)     | 1,36                          |

**Для продавца необходимо хранить**

Одинарные значения для продавцов останутся теми же, потому что преобладающая часть продавцов ещё и покупатели, однако именно объем для пользователя стоит переоценить.

Нужно хранить Аватарку (18 килобайт), идентификаторы товаров (16 * 546 = 8736 байт ≈ 8,53 кбайт), таким образом в среднем занимаемый объем ≈ 18 + 8,53 = 26,53 кбайт

Начнем с покупателей, которых 575 тыс., тогда объем для их хранения примерно 0,00002530 * 575 * 10^(3) ≈ 14,55 гигабайт, а прирост за месяц - 0,00002530 * 25 * 10^(3) ≈ 0,63 гигабайт

Как уже было описано ранее, пользователь заказывает где-то 8,7 заказов в месяц, тогда, основываясь на таблице 3, можно рассчитать, что заказы занимают 8,7 * 575 * 10^(3) * 0,00000026 = 1,3 гигабайта

Данные для товара можно взять из таблицы 9, т.к. добавлять новые товары могут только продавцы (не учитываем сотрудников).

Аналогично как для пользователей можно рассчитать и для продавцов: занимаемый отзывами объем ≈ 0,195 * 575000 * 0,00000012 ≈ 0,013 гигабайт

Таблица 10 - Оценка СРХП (продавцы)

| Оцениваемое         | средний размер в гигабайтах |
|---------------------|-----------------------------|
| 1 пользователь      | 0,00002530                  |
| 1 заказ             | 0,00000026                  |
| 1 товар             | 0,00013971                  |
| 1 отзыв             | 0,00000012                  |
| продавцы            | 14,55                       |
| продавцы (за месяц) | 0,63                        |
| заказы (за месяц)   | 1,3                         |
| товары (за месяц)   | 1204,99                     |
| отзывы (за месяц)   | 0,013                       |

> **Комментарий:**
> Для Посетителей и Пользователей СРХП не имеет смысла оценивать ввиду неясности зарегистрированности их аккаунтов, поэтому достаточно рассчитать для покупателей и продавцов

Таким образом ("x" означает, что достаточно данных для указанных выше групп, так как для них близко к точному значению оценить нет возможности):

Таблица 11 - результат оценки продуктовых метрик (СКДП более подробно можно рассмотреть в таблицах 5 - 8, а СРХП в таблицах 9 и 10)

| Пользователи | MAU (млн) | DAU (млн) | СРХП       | СКДП      |
|--------------|-----------|-----------|------------|-----------|
| Покупатели   | 58,18     | 20,94     | Таблица 9  | Таблица 5 |
| Продавцы     | 0,64      | 0,23      | Таблица 10 | Таблица 6 |
| Пользователи | 323,2     | 116,35    | x          | Таблица 7 |
| Посетители   | 436,7     | 157,21    | x          | Таблица 8 |

***Размер хранения в разбивке по типам данных (в штуках и в Тб)***

Выделим тут существенные блоки и оценим их объем для поддержания нынешнего MAU, выделим результаты в таблице 12.

Пройдясь по сайту ozon, по категориям, можно найти количество товаров (имеется ввиду сам товар (уникальный без учета их количества)) 1539462, но так как большинство товаров попадает примерно под 1-2 категории, то приблизительно число товаров - 1026308, тогда на их хранение нужно 0,00053548 * 1026308 ≈ 549,567408 гигабайт, что есть 0,53669 терабайт

Оценим сколько всего было заказов, известно [^26], что за 2020 год было 73.9 млн заказов, а за 2021 - 223.3, за 2022 - 465.4, за 2023 [^27] уже 966, а в 2024 (по прогнозу и данным из отчетов см таблицы 2 и 3) 1458,7 млн заказов, за года до можно примерно оценить, что их не более 100 млн. Тогда всего заказов примерно 3,2873 миллиарда заказов, тогда под хранение истории необходимо 0,83467 терабайт  	 		 	  	 	

Под каждым товаром примерно 300 отзывов, тогда можно оценить, что всего их примерно 308 млн. Тогда занимаемый ими объем 0,03609 терабайт.

При расчете покупателей и продавцов будем опираться на рассчитанные выше объемы памяти для хранения одного пользователя.

Таблица 12 - Размер хранения в разбивке по типам данных

| Оцениваемое | Количество   | примерный размер в тбайтах |
|-------------|--------------|----------------------------|
| Покупатели  | 58,18 млн.   | 0,97529                    |
| Продавцы    | 0,64 млн.    | 0,01421                    |
| Заказы      | 3,2873 млрд. | 0,83467                    |
| Товары      | 1026308      | 0,53669                    |
| Отзывы      | 308 млн.     | 0,03609                    |

***Сетевой трафик***

> **Комментарий:**
> При оценке будем опираться на рассчитанные выше объем для одного пользователя и умножать на DAU (20,94 млн.)

Пиковое значение активности пользователей (как и RPS соответственно) приблизительно в 3 раза выше среднего значения.

Начнем оценку с товаров, на запрос с сервера требуется 10,9 кб, а для картинки в среднем 20 кб. Учитывая DAU = 157,21 (не стандартное так как это нужно рассчитывать для посетителей) и значения из таблицы 8 можем сделать вывод, что в сутки запросы требуют 17551,37 Гбайт/сутки, а изображений 20 * 5 * 157,21 * 10^6 * 10,74 / 1024 / 1024 = 161021,75 Гбайт/сутки

Для поиска требуется 1,1 кб, тогда всего в сутки требуется 1,1 * 1,6 * 20,94 * 10^6 / 1024 / 1024 = 35,15 Гбайт/сутки

Для страницы товара в среднем требуется 33 кб и то что в среднем 7 фото у товара, где каждое по 18 кб, то ежедневное - 159 * 2,55 * 20,94 * 10^6 / 1024 / 1024 = 8096,81 Гбайт/сутки

Для отзыва по таблице 9 необходимо 0,00000012 гигабайт, а так как по таблице 5 покупатель добавляет отзыв 0,0065 раз в сутки, то есть 0,02 Гбайт/сутки

Тогда для прогрузки 10 отзывов нужно 0,00000120 Гб, тогда необходимо 256,31 Гбайт/сутки

![img_9.png](img%2F2%2Fimg_9.png)

Для добавления, как и редактирования количества товара в корзине необходим примерно 0,650 кб, тогда всего нужно 0,87 * 0,65  * 20,94 * 10^6 / 1024 / 1024 = 11,29 Гбайт/сутки, а для редактирования - 0,01 * 0,65  * 20,94 * 10^6 / 1024 / 1024 = 0,13 Гбайт/сутки

При просмотре истории заказов учтем, что в среднем у пользователей по 50 заказов (25 только за 2024), из которых загрузить нужно только последние 10 заказов, то за раз 10 раз прогружаются по 3 картинки товара и небольшие описания заказов, которые можно опустить ввиду наибольшего трафика именно на передачу изображений, что есть 10 * 3 * 20 * 0,725 * 20,94 * 10^6 / 1024 / 1024 = 8686,92 Гбайт/сутки

При оформлении заказа необходимо учесть, что в среднем заказывают 3 товары, где основную нагрузку принесут картинки товара при предпросмотре, то есть 3 * 20 - 60 кб, что есть 60 * 0,29 * 20,94 * 10^6 / 1024 / 1024 = 347,48 Гбайт/сутки

При добавлении товара отправляется запрос со всеми данными товара, то есть для суток это будет 0,00013971 * 575 * 10^3 * 0,5 = 40,17 Гбайт/сутки

Для получения значения в секунду (примерного) поделим полученные данные на 24 * 60 * 60 = 86400 секунд, а для получения пикового значения умножим на 3.

Таблица 13 - Сетевой трафик

| Оцениваемое                                        | Отправка Гбит/с | Пиковая отправка Гбит/с | Суммарный суточный Гбайт/сутки |
|----------------------------------------------------|-----------------|-------------------------|--------------------------------|
| Подгрузка изображений при прогрузке товаров        | 1,86368         | 5,59103                 | 161021,75                      |
| Прогрузка товаров (по 5)                           | 0,20314         | 0,60942                 | 17551,37                       |
| Использование поиска (количество блочных загрузок) | 0,00041         | 0,00123                 | 35,15                          |
| Просмотр страницы товаров                          | 0,09371         | 0,28114                 | 8096,81                        |
| Работа с отзывами (добавление)                     | 0,0000002       | 0,0000007               | 0,02                           |
| Прогрузка отзывов (по 10)                          | 0,00297         | 0,00890                 | 256,31                         |
| Работа с корзиной (добавление)                     | 0,00013         | 0,00039                 | 11,29                          |
| Работа с корзиной (редактирование)                 | 0,0000015       | 0,0000045               | 0,13                           |
| Просмотр истории заказов                           | 0,10054         | 0,30163                 | 8686,92                        |
| Заказ (Оформление)                                 | 0,00402         | 0,01206                 | 347,48                         |
| Просмотр корзины                                   | 0,00402         | 0,01206                 | 347,48                         |
| Добавление товара (продавец)                       | 0,00046         | 0,00139                 | 40,17                          |

***RPS***

Рассчитаем RPS для основных запросов и выпишем их в таблице 14. Будем опираться на уже посчитанные данные в таблице 5 для расчета всего кроме подгрузке товаров и изображений для него и выставления товаров на продажу. Возьмем значение из таблицы 5 и поделим на 86400, тем самым получив среднее значение RPS, но перед этим надо умножить на значение из таблицы 4 - 20,94 * 10^6

Для добавления товара данные нужно взять из таблицы 6 и умножить на DAU продавцов, а затем уже делить на 86400.

А для первых 2 то же, что и для большинства, но DAU - 157,21 и данные берем из таблицы 8.

На основании таблиц 2 и 4 мы модем заметить, что за Q4 зарегистрировалось 58,18 - 53,5 = 4,68 млн. пользователей, что есть примерно 50870 человек в день, тогда RPS для регистрации - 0,59 

Авторизацию в среднем примем равной регистрации, но для зашедших с других устройств примем что больше на 10%.

Таблица 13 - RPS

| Оцениваемое                                        | RPS      | Пиковое RPS |
|----------------------------------------------------|----------|-------------|
| Подгрузка изображений при прогрузке товаров        | 97710,40 | 293131,20   |
| Прогрузка товаров (по 5)                           | 19542,08 | 58626,23    |
| Использование поиска (количество блочных загрузок) | 387,78   | 1163,33     |
| Просмотр страницы товаров                          | 618,02   | 1854,06     |
| Работа с отзывами (добавление)                     | 1,57     | 4,73        |
| Прогрузка отзывов (по 10)                          | 2472,08  | 7416,25     |
| Работа с корзиной (добавление)                     | 210,85   | 632,56      |
| Работа с корзиной (редактирование)                 | 24,24    | 72,71       |
| Просмотр истории заказов                           | 175,71   | 527,13      |
| Заказ (Оформление)                                 | 70,28    | 210,85      |
| Просмотр корзины                                   | 70,28    | 210,85      |
| Добавление товара (продавец)                       | 3,33     | 9,98        |
| Регистрация                                        | 0,59     | 1,77        |
| Авторизация                                        | 0,65     | 1,95        |

---

## 3. Глобальная балансировка нагрузки <a name="глобальная-балансировка-нагрузки"></a>

### Домены

Совместив несколько аналитических систем DNS найдем те, что принадлежат копании ozon (не полный список, так как информация общественно не публикуется): 

Пробьем на каких серверах DNS лежит ozon.ru - основной сайт, получим: [^28]

![img.png](img/3/img.png)

А дальше найдем ip адреса: [^29]

*Для nsz501s1.ozon.ru:*

![img_1.png](img%2F3%2Fimg_1.png)

*Для nsz502s1.ozon.ru:*

![img_2.png](img%2F3%2Fimg_2.png)

*Для nsz503s1.ozon.ru:*

![img_3.png](img%2F3%2Fimg_3.png)

> **Комментарий:**
> Таким же образом можно пробить наличие и других доменных имен: job-ozon.ru, geozon.ru, corp.ozon.ru... Но в условиях интернет магазина их рассматривать не будем

Таким образом выделим домены: ozon.ru (основа, Россия), ozon.by (Беларуссия), ozonru.eu (Европейский союз), ozon.kz (Казахстан), ozonru.co.il (комерческие организации в Израеле), ozon.com (за пределами России (США)), ozonru.com (за пределами России (США)). Все эти домены тем или иным способом связаны с блоком интернет-магазин компании ozon.

Каждый домен обрабатывает запросы пользователей из соответствующего региона, что снижает задержки и оптимизирует маршрутизацию данных.

Теперь проверим нагрузки на эти домены:

> **Комментарий:**
> Воспользуемся сервисом pr-cy, так как тут точность нам не важна, нужно лишь примерно оценить на какой домен призводится наибольшая нагрузка.

*ozon.ru:*

![img_4.png](img%2F3%2Fimg_4.png)

*ozon.by:*

![img_5.png](img%2F3%2Fimg_5.png)

*ozonru.eu:*

> Нет данных

*ozon.kz:*

![img_6.png](img%2F3%2Fimg_6.png)

*ozonru.co.il:*

> Нет данных

*ozon.com:*

![img_7.png](img%2F3%2Fimg_7.png)

*ozonru.com:*

> Нет данных

Таким образом основываясь на это и пункт 1 можно сделать вывод, что основная нагрузка идет на Россию, а если быть точнее, то на ozon.ru

### Расположение ЦОДов

Так как около 95% всей нагрузки приходится на россию, то будем определять расположение ЦОДов в основном на территории РФ, однако так как сайт работает и за её пределами, то и ЦОДы должны находиться не только на её территории. Так же стоит учесть, что для CDN список ЦОДов может быть расширен, однако в условиях данный работы будем считать, что они находятся на этих же ЦОДах.

Проанализируем где лучше всего разместить ДЦ, для этого воспользуемся картой, которая показывает население россии [^30] и картой показывающей карту покрытия сетью [^31]. Также учтем то, что необходимы ЦОДы тир 3, ну или минимум 2, для этого воспользуемся сайтом в котором собраны ЦОДы России [^32]. 

Таким образом выделим предположительные основные города в которых сосредоточены ЦОДы:
- Москва - главный хаб, высокая концентрация пользователей (Центральный, Северо-Западный и Приволжский округа, Беларуссия, Германия)
- Санкт-Петербург - высокая концентрация пользователей (Северо-Западный и Центральный округа)
- Новосибирск (Дальневосточный, Уральский и Сибирский округа, Казахстан и другие страны Азии)
- Екатеринбург (Уральский, Сибирский и Приволжский округа, Казахстан)
- Ростов-на-Дону (Южный, Северо-Кавказский и Центральный округа, Беларуссия, Германия, Украина и другие страны Европы)

Пусть и слабо пока развитый, но так как есть домен для США, то имеет смысл расположить ЦОДы и в Вашингтоне (под развитие).

### Схема балансировки

Сначала применяется DNS

***Схема DNS-балансировки***

DNS-балансировка распределяет трафик между дата-центрами на основе местоположения пользователя:
- GeoDNS – определяет ближайший ЦОД и направляет запросы к нему (их может прийти несколько и тогда применяется уже Round-robin DNS).
- Round-robin DNS – равномерное распределение запросов между доступными узлами.
- Failover-механизм – при отказе одного из дата-центров трафик перенаправляется на резервные узлы.

После этого применяется уже BGP Anycast для определения ДЦ на который нужно обратиться.

***Схема Anycast-балансировки***

Anycast позволяет оптимизировать маршрутизацию трафика за счет выбора ближайшего узла:
- Anycast IP – один IP-адрес, доступный из разных дата-центров.
- BGP-анонсирование – трафик направляется к ближайшему доступному узлу.
- Минимизация задержек – запросы обслуживаются ближайшим ЦОДом, что повышает скорость работы платформы.

---

## 4. Локальная балансировка нагрузки <a name="локальная-балансировка-нагрузки"></a>

### **Балансировка после прихода запроса на ЦОД**

1. **L7-балансировка на уровне дата-центра**
   - Запрос приходит на внешние балансировщики L7 (NGINX), которые выполняют SSL-терминацию.
   - Входящий трафик анализируется, а затем маршрутизируется на следующий уровень.

2. **L7-балансировка внутри дата-центра**
   - Внутренний балансировщик NGINX распределяет трафик между сервисами в зависимости от:
      - URI запроса
      - заголовков
      - cookies пользователя (для привязки к серверу)
      - нагрузки на сервера

3. **Маршрутизация в Kubernetes**
   - Kubernetes получает запрос и перенаправляет его на нужный сервис (через `ingress-nginx`).
   - K8s Service определяет, какой конкретный под (instance) обработает запрос.
   - Если один под недоступен, запрос перенаправляется на следующий.

4. **Обработка на бэкенде**
   - Приложение обрабатывает запрос и взаимодействует с базой данных, кэшем, API других сервисов.
   - Ответ возвращается через те же уровни в обратном порядке.

### **Схема отказоустойчивости**

1. **Kubernetes**
   - Использует readiness-пробы для мониторинга состояния подов.
   - Если под перестает отвечать, он исключается из балансировки.
   - Auto-scaling позволяет адаптироваться к нагрузке.

2. **NGINX**
   - Перезапускает серверы без downtime.
   - Реализует retry запросов, если бэкенд не отвечает.
   - Обновляет конфигурации без прерывания работы.

3. **Active-Active NGINX**

---

## 5. Логическая схема БД <a name="логическая-схема-бд"></a>

Полную версию схемы бд можно посмотреть по ссылке [https://www.drawdb.app/editor?shareId=b53cf5f4253d7b82c51b3d435ac52a20](https://www.drawdb.app/editor?shareId=b53cf5f4253d7b82c51b3d435ac52a20)

Либо на изображении и приближенных фрагментах, указанных ниже:

**Общая схема:**

![img_6.png](img%2F5%2Fimg_6.png)
 
**Теперь покажем приближенные фрагменты**

*Пользователь:*

![img_1.png](img%2F5%2Fimg_1.png)

*Сессия:*

![img_2.png](img%2F5%2Fimg_2.png)

*Продукт:*

![img_3.png](img%2F5%2Fimg_3.png)

*Отзыв:*

![img.png](img%2F5%2Fimg.png)

*Продавец:*

![img_4.png](img%2F5%2Fimg_4.png)

*Заказ:*

![img_5.png](img%2F5%2Fimg_5.png)

---

## 6. Физическая схема БД <a name="физическая-схема-бд"></a>

URL: [https://www.drawdb.app/editor?shareId=b53cf5f4253d7b82c51b3d435ac52a20](https://www.drawdb.app/editor?shareId=b53cf5f4253d7b82c51b3d435ac52a20)

**Общая схема:**

![img.png](img%2F6%2Fimg.png)

Для оптимизации производительности и масштабируемости данные разделены на несколько баз данных по функциональным областям. Каждая база данных настроена для обработки специфических запросов с учетом высокой нагрузки.

### 0. Сессии и кеши
| **Таблица**       | **Описание**                                                                                          | **Индексы**                    | **Денормализация**                                                  | **СУБД**     | **Шардирование** | **Резервирование**   | **Клиентские библиотеки / Интеграции**             |
|-------------------|-------------------------------------------------------------------------------------------------------|--------------------------------|---------------------------------------------------------------------|--------------|------------------|----------------------|----------------------------------------------------|
| `session`         | Данные сессий пользователей для аутентификации и аналитики.                                           | `session_id` (PK), `buyer_id`  | Нет                                                                 | Redis        | По `buyer_id`    | Репликация + AOF/RDB | Redis-py (Python), Jedis (Java)                    |
| `cash-buyer`      | Кэш данных покупателя: имя, телефон, изображение, город, страна. Связан с сессией через `session_id`. | `session_id` (PK)              | Данные дублируются из `Buyer` для быстрого доступа по `session_id`. | Redis        | По `session_id`  | Репликация + AOF/RDB | Redis-py (Python), Jedis (Java)                    |
| `cash-cart`       | Кэш корзины: список товаров, общая сумма. Связан с сессией через `session_id`.                        | `session_id` (PK)              | `products` в JSONB для хранения списка товаров без JOIN.            | Redis        | По `session_id`  | Репликация + AOF/RDB | Redis-py (Python), Jedis (Java)                    |
| `cash-categories` | Кэш категорий продуктов: структура категорий и подкатегорий. Связан с сессией через `session_id`.     | `session_id` (PK)              | `categories` в JSONB для хранения вложенных данных категорий.       | Redis        | По `session_id`  | Репликация + AOF/RDB | Redis-py (Python), Jedis (Java)                    |

**Объяснение:**
- **Объединение:** данные по сессии и кеши объединены в одну базу данных, так как они часто запрашиваются вместе и требуют высокой скорости доступа.
- **Добавленные кэш-таблицы:**
   - **`cash-buyer`:** хранит часто используемые данные покупателя (`name`, `phone`, `img`, `city`, `country`) для быстрого доступа по `session_id`.
   - **`cash-cart`:** хранит данные корзины (`products` в JSONB, `total`) для быстрого доступа и обновления. 
   - **`cash-categories`:** хранит структуру категорий и подкатегорий в JSONB для быстрого отображения каталога.
- **Индексы:** уникальный индекс на `session_id` обеспечивает быстрый доступ к кэшированным данным.
- **Денормализация:** в `cash-cart` и `cash-categories` используется JSONB для хранения вложенных данных (список товаров и категории), что ускоряет доступ и исключает необходимость в JOIN.
- **СУБД:** Redis выбран для кэш-таблиц из-за высокой скорости работы с данными в памяти;
- **Шардирование:** по `session_id` для равномерного распределения нагрузки между шардами.
- **Резервирование:** репликация обеспечивает отказоустойчивость.

### 1. Пользовательские данные
| **Таблица**      | **Описание**                                                                          | **Индексы**                                                                                            | **Денормализация**                                                                                            | **СУБД**     | **Шардирование** | **Резервирование**                | **Клиентские библиотеки / Интеграции**             |
|------------------|---------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|--------------|------------------|-----------------------------------|----------------------------------------------------|
| `Buyer`          | Хранит основные данные покупателей: имя, контактные данные, метрики для рекомендаций. | `id` (PK), `email` (уникальный), `phone` (уникальный), `create_at`, `changed_at`, `date_of_last_visit` | `recommendation_data` в JSONB для хранения просмотров и покупок без JOIN; `gender` в JSONB для опознания пола | PostgreSQL   | По `id`          | Репликация + WAL + pg_basebackup  | SQLAlchemy (Python), Hibernate (Java), Redis (кэш) |
| `Buyer-passport` | Паспортные данные покупателей для идентификации.                                      | `buyer_id` (PK)                                                                                        | Нет                                                                                                           | PostgreSQL   | По `buyer_id`    | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate                              |
| `Buyer-contacts` | Дополнительные контакты покупателей для поиска и рекламы.                             | `buyer_id` (PK), `phone`                                                                               | Нет                                                                                                           | PostgreSQL   | По `buyer_id`    | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate                              |
| `cart`           | Корзина покупателя: товары, адрес доставки.                                           | `buyer_id` (PK)                                                                                        | `products` в JSONB для хранения списка товаров без JOIN.                                                      | PostgreSQL   | По `buyer_id`    | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate, Redis (кэш)                 |
| `user-features`  | Возможности пользователей для рекомендаций.                                           | `user_id` (PK), `feature_name`                                                                         | Да (key-value структура)                                                                                      | PostgreSQL   | По `user_id`     | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate                              |

**Объяснение:**
- **Объединение:** отдельная база данных для пользовательских данных, так как они часто запрашиваются вместе и требуют высокой скорости доступа и транзакционной целостности.
- **Индексы:** уникальные индексы на `email` и `phone` для быстрого поиска. Индексы на даты для аналитики.
- **Денормализация:** `recommendation_data` в `Buyer` хранит метрики и историю в JSONB, чтобы избежать JOIN.
- **СУБД:** PostgreSQL для сложных транзакций.
- **Шардирование:** по `buyer_id` для равномерного распределения нагрузки.
- **Резервирование:** репликация для отказоустойчивости.

### 2 Продукты и связанные данные

#### БД с основными данными (PostgreSQL)
| **Таблица**          | **Описание**                                                 | **Индексы**                                                 | **Денормализация**                                                             | **СУБД**     | **Шардирование**   | **Резервирование**                 | **Клиентские библиотеки / Интеграции** |
|----------------------|--------------------------------------------------------------|-------------------------------------------------------------|--------------------------------------------------------------------------------|--------------|--------------------|------------------------------------|----------------------------------------|
| `product`            | Основные данные о продуктах: название, цена, характеристики. | `id` (PK), `seller_id`, `title`, `created_at`, `changed_at` | `characteristics`, `breadcrumbs`, `img` в JSONB для быстрого доступа без JOIN. | PostgreSQL   | По `id`            | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `product-filter`     | Данные для фильтрации продуктов: цена, вес, категории.       | `product_id` (PK)                                           | Дублирует данные из `product` и `product-search` для ускорения фильтрации.     | PostgreSQL   | По `product_id`    | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `product-reviews`    | Количество отзывов по продуктам.                             | `product_id` (PK)                                           | Нет                                                                            | PostgreSQL   | По `product_id`    | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `rating-product`     | Рейтинг продуктов: количество оценок и их сумма.             | `product_id` (PK)                                           | Нет                                                                            | PostgreSQL   | По `product_id`    | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `product-categories` | Категории продуктов и подкатегории.                          | `id` (PK), `title`                                          | `subcategories` в JSONB для хранения вложенных данных.                         | PostgreSQL   | Нет                | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `seller-rating`      | Рейтинг продавцов: сумма и количество оценок.                | `seller_id` (PK)                                            | Нет                                                                            | PostgreSQL   | По `seller_id`     | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `item_features`      | Характеристики продуктов для рекомендаций.                   | `product_id` (PK), `feature_name`                           | Да (key-value структура)                                                       | PostgreSQL   | По `product_id`    | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |

#### БД для поиска (Elasticsearch)
| **Таблица**                | **Описание**                                                 | **Индексы**                                                 | **Денормализация**                                                             | **СУБД**       | **Шардирование**  | **Резервирование**           | **Клиентские библиотеки / Интеграции**      |
|----------------------------|--------------------------------------------------------------|-------------------------------------------------------------|--------------------------------------------------------------------------------|----------------|-------------------|------------------------------|---------------------------------------------|
| `product-search`           | Данные для полнотекстового поиска: название, метрики.        | `product_id` (PK), `title`                                  | Денормализована для быстрого поиска, дублирует данные из `product`.            | Elasticsearch  | По `product_id`   | Снапшоты + репликация шардов | Elasticsearch-Py (Python), Java REST Client |

**Объяснение:**
- **Объединение:** отдельная база данных для продуктов, так как они часто запрашиваются вместе и требуют быстрого поиска.
- **Индексы:** `seller_id` для поиска по продавцу, `title` для поиска по названию.
- **Денормализация:** `product-search` и `recomendation` содержат дублирующие данные для ускорения операций.
- **СУБД:** Elasticsearch для `product-search` (поиск), PostgreSQL для остальных (транзакции и аналитика).
- **Шардирование:** по `product_id` для распределения нагрузки.
- **Резервирование:** репликация для отказоустойчивости.

### 3. Отзывы и рейтинги
| **Таблица**    | **Описание**                                  | **Индексы**                                         | **Денормализация**                                  | **СУБД**      | **Шардирование**  | **Резервирование**                | **Клиентские библиотеки / Интеграции**      |
|----------------|-----------------------------------------------|-----------------------------------------------------|-----------------------------------------------------|---------------|-------------------|-----------------------------------|---------------------------------------------|
| `review`       | Отзывы о продуктах: текст, автор, медиа.      | `id` (PK), `product_id`, `author_id`, `added_at`    | `img` в JSONB для хранения медиа без JOIN.          | PostgreSQL    | По `product_id`   | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate, Kafka (очереди)      |
| `review-like`  | Лайки и дизлайки отзывов.                     | `review_id` (PK)                                    | Нет                                                 | PostgreSQL    | По `review_id`    | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate, Kafka (очереди)      |

**Объяснение:**
- **Объединение:** отдельная база данных для отзывов из-за их объема и необходимости отдельного управления.
- **Индексы:** `product_id` и `author_id` для быстрого доступа к отзывам по продукту или автору.
- **Денормализация:** `img` в JSONB для уменьшения JOIN.
- **СУБД:** PostgreSQL для транзакций и сложных запросов.
- **Шардирование:** по `product_id` или `review_id` для распределения нагрузки.
- **Резервирование:** репликация для отказоустойчивости.

### 4. Продавцы и их данные
| **Таблица**                 | **Описание**                                                | **Индексы**                         | **Денормализация**       | **СУБД**       | **Шардирование**   | **Резервирование**                 | **Клиентские библиотеки / Интеграции** |
|-----------------------------|-------------------------------------------------------------|-------------------------------------|--------------------------|----------------|--------------------|------------------------------------|----------------------------------------|
| `seller`                    | Данные продавцов: список продуктов и их количество.         | `buyer_id` (PK)                     | Да (JSONB для продуктов) | PostgreSQL     | По `buyer_id`      | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `seller-data`               | Данные продавцов: ИНН, банковские реквизиты.                | `buyer_id` (PK)                     | Нет                      | PostgreSQL     | По `buyer_id`      | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `seller-rating-buyer`       | Рейтинг продавцов от покупателей.                           | `buyer_id` (PK)                     | Нет                      | PostgreSQL     | По `buyer_id`      | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |
| `seller-products-analytics` | Аналитика продуктов продавца: посещения, покупки, рейтинги. | `id` (PK), `buyer_id`, `product_id` | Нет                      | PostgreSQL     | По `buyer_id`      | Репликация + WAL + pg_basebackup   | SQLAlchemy, Hibernate                  |

**Объяснение:**
- **Объединение:** отдельная база данных для продавцов, так как данные связаны с продуктами и пользователями.
- **Индексы:** индексы на ключи для быстрого доступа к данным продавцов и их продуктов.
- **Денормализация:** не применяется, так как данные нормализованы для целостности.
- **СУБД:** PostgreSQL для транзакций и аналитики.
- **Шардирование:** по `buyer_id` для распределения нагрузки.
- **Резервирование:** репликация для отказоустойчивости.

### 5. Заказы и корзины
| **Таблица**    | **Описание**                                       | **Индексы**                                          | **Денормализация**                                                                                                      | **СУБД**       | **Шардирование** | **Резервирование**                | **Клиентские библиотеки / Интеграции** |
|----------------|----------------------------------------------------|------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|----------------|------------------|-----------------------------------|----------------------------------------|
| `order`        | Заказы: товары, адрес, статус оплаты.              | `id` (PK), `buyer_id`, `created_at`, `delivery_date` | `products`, `paid_method` (внутри него `parameters` в JSONB для гибкости) и `address_data` в JSONB для уменьшения JOIN. | PostgreSQL     | По `buyer_id`    | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate, Kafka (очереди) |
| `order-status` | Статусы заказов: текущий статус и время изменения. | `order_id` (PK)                                      | `status` в JSONB для определения статуса заказа                                                                         | PostgreSQL     | По `order_id`    | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate                  |
| `address`      | Адреса доставки: страна, город, улица.             | `address_id` (PK)                                    | Нет                                                                                                                     | PostgreSQL     | По `address_id`  | Репликация + WAL + pg_basebackup  | SQLAlchemy, Hibernate                  |

**Объяснение:**
- **Объединение:** отдельная база данных для заказов из-за высоких требований к целостности и транзакциям.
- **Индексы:** `buyer_id` для доступа к заказам пользователя, даты для аналитики.
- **Денормализация:** `products` в JSONB в `cart` и `order` для ускорения доступа.
- **СУБД:** PostgreSQL для транзакционной поддержки.
- **Шардирование:** по `buyer_id` или `order_id` для распределения нагрузки.
- **Резервирование:** репликация для отказоустойчивости.

### 6. Отдельная бд для DWH в ClickHouse
| **Таблица**               | **Описание**                                                            | **Индексы**       | **Денормализация**                  | **СУБД**    | **Шардирование** | **Резервирование** | **Клиентские библиотеки / Интеграции** |
|---------------------------|-------------------------------------------------------------------------|-------------------|-------------------------------------|-------------|------------------|--------------------|----------------------------------------|
| **`DWH-buyer`**           | Аналитические данные о покупателях: прибыль, покупки, просмотры.        | `buyer_id` (PK)   | Да (JSONB для покупок и просмотров) | ClickHouse  | По `buyer_id`    | Репликация         | clickhouse-driver, JDBC                |
| **`DWH-product`**         | Аналитические данные о продуктах: посещения, покупки, отзывы, рейтинги. | `product_id` (PK) | Нет                                 | ClickHouse  | По `product_id`  | Репликация         | clickhouse-driver, JDBC                |
| **`DWH-product-views`**   | Необработанные данные о просмотрах продуктов пользователями.            | `id` (PK)         | Нет                                 | ClickHouse  | По `product_id`  | Репликация         | clickhouse-driver, JDBC                |
| **`DWH-purchases`**       | Необработанные данные о покупках с указанием количества и цены.         | `id` (PK)         | Нет                                 | ClickHouse  | По `product_id`  | Репликация         | clickhouse-driver, JDBC                |
| **`DWH-reviews-raw`**     | Необработанные данные отзывов с оценками и комментариями.               | `id` (PK)         | Нет                                 | ClickHouse  | По `product_id`  | Репликация         | clickhouse-driver, JDBC                |

#### Объяснение для таблиц `DWH-buyer` и `DWH-product`:
- **Объединение**: таблицы предназначены для аналитики и интегрируются в Data Warehouse (DWH). `DWH-buyer` связана с таблицей `Buyer` через `buyer_id`, а `DWH-product` — с таблицей `product` через `product_id`. Они оптимизированы для быстрой обработки больших объемов данных, так же добавлены DWH на события покупки, просмотра и оставления отзыва.
- **Индексы**:
   - Для `DWH-buyer`: первичный ключ `buyer_id` обеспечивает уникальность и быстрый доступ.
   - Для `DWH-product`: первичный ключ `product_id` обеспечивает уникальность и быстрый доступ.
   - Для `DWH-product-views`: первичный ключ `id` обеспечивает уникальность и быстрый доступ.
   - Для `DWH-purchases`: первичный ключ `id` обеспечивает уникальность и быстрый доступ.
   - Для `DWH-reviews-raw`: первичный ключ `id` обеспечивает уникальность и быстрый доступ.
- **Денормализация**:
   - В `DWH-buyer` поля `purchased_products` и `views_product` используют JSONB для хранения списков купленных и просмотренных продуктов, что ускоряет аналитические запросы без дополнительных соединений.
   - В `DWH-product`, `DWH-product-views`, `DWH-purchases` и `DWH-reviews-raw` денормализация не применяется, так как данные нормализованы для точности аналитики.
- **СУБД**: используется ClickHouse, который оптимизирован для аналитических запросов и обработки больших объемов данных.
- **Шардирование**:
   - Для `DWH-buyer`: по `buyer_id` для равномерного распределения данных о покупателях.
   - Для `DWH-product`: по `product_id` для распределения данных о продуктах.
   - Для `DWH-product-views`: по `product_id` для распределения данных о продуктах.
   - Для `DWH-purchases`: по `product_id` для распределения данных о продуктах.
   - Для `DWH-reviews-raw`: по `product_id` для распределения данных о продуктах.
- **Резервирование**: репликация в ClickHouse обеспечивает отказоустойчивость и доступность данных.
- **Клиентские библиотеки**: интеграция осуществляется через `clickhouse-driver` для Python или JDBC для Java, что соответствует требованиям аналитических приложений.

### Итоговые замечания
- **Индексы:** настроены для ускорения часто выполняемых запросов (поиск, фильтрация, аналитика).
- **Денормализация:** применяется для уменьшения JOIN и ускорения доступа к данным (JSONB активно используется).
- **Выбор СУБД:** PostgreSQL для транзакций и сложных запросов, Elasticsearch для поиска, Redis для сессий и кешей и ClickHouse для DWH.
- **Шардирование и резервирование:** по ключевым полям для масштабируемости и отказоустойчивости.
- **Клиентские библиотеки:** SQLAlchemy и Hibernate для ORM, Redis для кэширования, Kafka/RabbitMQ для очередей.

### Балансировка запросов / мультиплексирование подключений

Для оптимизации производительности и масштабируемости системы сайта OZON, где данные распределены по нескольким базам данных (сессии и кэши, пользовательские данные, продукты, отзывы, продавцы, заказы), необходимо учитывать как локальную балансировку (внутри одного центра обработки данных, ЦОДа), так и глобальную балансировку (между ЦОДами в разных регионах). Это важно для обеспечения низких задержек, высокой доступности и отказоустойчивости, учитывая глобальное присутствие сайта.

#### Балансировка запросов

Балансировка запросов распределяет нагрузку между серверами или экземплярами баз данных, обеспечивая равномерное использование ресурсов и минимизацию задержек. Мы разделим подход на глобальный и локальный уровни.

##### Глобальная балансировка запросов
На глобальном уровне запросы распределяются между ЦОДами, расположенными в разных регионах, чтобы пользователи получали доступ к ближайшему доступному ЦОДу.

- **Методы:**
   - **GeoDNS**: направляет запросы к ближайшему ЦОДу на основе геолокации пользователя. Например, пользователи из Москвы обращаются к ЦОДу в Москве.
   - **BGP Anycast**: один IP-адрес обслуживается несколькими ЦОДами, автоматически направляя трафик к ближайшему узлу по маршрутам BGP.
   - **Failover**: при отказе одного ЦОДа трафик перенаправляется на другой доступный ЦОД.

- **Применение:**
   - **DWH** (ClickHouse): данные в ClickHouse реплицируются между ЦОДами для обеспечения доступности и снижения задержек. Запросы на чтение (например, аналитика заказов или поведения пользователей) направляются к ближайшему ЦОДу, а при его недоступности — к резервному. Запись дублируется в центральный ЦОД (в Москве), который затем синхронизирует данные с региональными ЦОДами, и ближайшим, с которым происходит общение. 
   - **Сессии и кэши (Redis)**: данные сессий (`session`, `cash-buyer`, `cash-cart`) реплицируются между ЦОДами с использованием глобального кэша (например, Redis Cluster с георепликацией). Запросы на чтение идут к ближайшему ЦОДу, а при его недоступности — к резервному.
   - **Пользовательские данные (PostgreSQL)**: данные пользователей (`Buyer`, `cart`) шардированы по регионам (см. часть про глобальную балансировку). Запросы на чтение обслуживаются локальными репликами, а запись идет и на региональный ЦОД, и на мастер в основном ЦОДе,который затем раскидывает данные на все остальные.
   - **Продукты (PostgreSQL и Elasticsearch)**: данные продуктов (`product`, `product-filter`) также могут быть шардированы по регионам. Поисковые запросы в Elasticsearch распределяются по ближайшему кластеру.
   - **Отзывы, продавцы, заказы (PostgreSQL)**: георепликация или шардирование по `product_id`, `buyer_id`, `order_id` обеспечивает доступность данных ближе к пользователю.

- **Инструменты:**
   - GeoDNS-серверы (Cloudflare, Route 53).
   - BGP Anycast через сетевую инфраструктуру провайдера.

##### Локальная балансировка запросов
Внутри каждого ЦОДа запросы распределяются между серверами и экземплярами баз данных для оптимизации локальных ресурсов.

- **Применение:**
   - **DWH** (ClickHouse): поддерживает кластерную архитектуру с шардированием и репликацией данных между узлами. Запросы распределяются между узлами кластера для параллельной обработки. Локальный балансировщик (HAProxy) направляет запросы к доступным узлам ClickHouse внутри ЦОДа.
   - **Сессии и кэши (Redis)**: локальный балансировщик (HAProxy) распределяет запросы между шардами Redis внутри ЦОДа. Redis Cluster обеспечивают автоматическое переключение при сбоях.
   - **Пользовательские данные (PostgreSQL)**: запросы на чтение (`SELECT`) распределяются между локальными репликами через HAProxy, а на запись (`INSERT`, `UPDATE`) — на мастер. Шардирование по `buyer_id`.
   - **Продукты (PostgreSQL и Elasticsearch)**: в PostgreSQL запросы на чтение идут на локальные реплики, в Elasticsearch — встроенная кластеризация распределяет нагрузку.
   - **Отзывы, продавцы, заказы (PostgreSQL)**: аналогично, чтение — на реплики, запись — на мастер, с локальным шардированием.

- **Инструменты:**
   - **HAProxy**: Балансировка TCP/HTTP-запросов.
   - **ClickHouse Distributed Table**: распределяет запросы по шардам и репликам в ClickHouse.
   - **Redis Cluster**: управление шардами и репликами Redis.

#### Мультиплексирование подключений

Мультиплексирование позволяет использовать одно подключение для нескольких запросов, снижая нагрузку на серверы баз данных.

- **Принципы:**
   - Одно физическое подключение обслуживает множество клиентов.
   - Уменьшает задержки и накладные расходы.

- **Применение:**
   - **DWH** (ClickHouse): клиентские библиотеки (например, clickhouse-driver для Python или JDBC для Java) поддерживают мультиплексирование, позволяя отправлять несколько запросов через одно подключение. Пулинг подключений повторно использует существующие соединения, снижая нагрузку на сервер.
   - **Сессии и кэши (Redis)**: клиентские библиотеки (Redis-py, Jedis) поддерживают мультиплексирование, отправляя команды через одно подключение к шардам в локальном ЦОДе.
   - **Пользовательские данные, продукты, отзывы, продавцы, заказы (PostgreSQL)**: PgBouncer создает пул подключений, мультиплексируя запросы от приложений к мастеру и репликам внутри ЦОДа. Например, 100 клиентов используют 10 подключений.
   - **Продукты (Elasticsearch)**: HTTP-запросы мультиплексируются через клиентские библиотеки (Elasticsearch-Py).

- **Инструменты:**
   - **clickhouse-driver**: для Python, мультиплексирование в ClickHouse.
   - **PgBouncer**: для PostgreSQL, оптимизирует подключения внутри ЦОДа.
   - Клиентские библиотеки для Redis и Elasticsearch.

- **Пример запроса:**
   - Глобально: GeoDNS → BGP Anycast → HAProxy → PgBouncer → PostgreSQL (реплики/мастер).
   - Локально: Приложение → HAProxy → Redis Cluster в ЦОДе.

#### Интеграция
- Глобальная балансировка направляет трафик к ближайшему ЦОДу, а локальная — распределяет нагрузку внутри него.
- Мультиплексирование оптимизирует подключения на обоих уровнях, снижая накладные расходы.

### Схема резервного копирования

Схема резервного копирования только для центрального ЦОДа, так как в региональных будем если что брать данные с центрального.

#### Принципы
- **Регулярность**: копии создаются ежедневно или чаще.
- **Полнота**: включают все данные для восстановления.
- **Тестирование**: регулярная проверка восстановления.

#### Типы резервных копий
- **Полные**: еженедельные копии всех данных.
- **Инкрементные**: ежедневные копии изменений.
- **Дифференциальные**: изменения с последней полной копии.

#### Глобальное резервное копирование
- **DWH (ClickHouse)**:
   - Полные копии данных еженедельно.
   - Инкрементные копии ежедневно.
   - Хранение: Копии реплицируются в другой ЦОД.
- **Сессии и кэши (Redis)**:
   - Полные копии (RDB) еженедельно, инкрементные (AOF) каждые 5 минут.
   - Хранение: Копии реплицируются в ещё один ЦОД.
- **Пользовательские данные, продукты, отзывы, продавцы, заказы (PostgreSQL)**:
   - Полные копии через `pg_basebackup` еженедельно.
   - Инкрементные копии через WAL ежедневно, отправляются в центральное хранилище.
   - Хранение: Копии в ЦОДе Москвы.
- **Продукты (Elasticsearch)**:
   - Полные снимки еженедельно, инкрементные — ежедневно.
   - Хранение: Репозиторий в другом ЦОДе.

#### Локальное резервное копирование
- **ClickHouse**: локальные полные и инкрементные копии для быстрого восстановления внутри ЦОДа. Автоматическое переключение на резервные узлы при сбоях.
- **Redis**: локальные AOF и RDB для быстрого восстановления в ЦОДе.
- **PostgreSQL**: локальные полные и инкрементные копии, автоматическое переключение на резервный мастер при сбоях.
- **Elasticsearch**: локальные снимки для восстановления внутри ЦОДа.

#### Пример графика
- **Ежедневно**:
   - ClickHouse: инкрементные копии в 01:00.
   - Redis: AOF каждые 5 минут.
   - PostgreSQL: WAL в 00:00.
   - Elasticsearch: инкрементные снимки в 01:00.
- **Еженедельно (воскресенье)**:
   - ClickHouse: полные копии в 02:00.
   - Redis: RDB в 02:00.
   - PostgreSQL: `pg_basebackup` в 03:00.
   - Elasticsearch: полный снимок в 04:00.

#### Интеграция с системой
- Глобально: копии распределяются между ЦОДами для защиты от сбоев.
- Локально (на центральном ЦОДе): копии используются для быстрого восстановления внутри ЦОДа.

### Итоговая архитектура
- **Балансировка запросов**:
   - **Глобально**: GeoDNS и BGP Anycast направляют трафик к ближайшему ЦОДу, данные реплицируются или шардируются по регионам.
   - **Локально**: HAProxy и встроенные механизмы (ClickHouse Distributed Table, Redis Cluster) распределяют запросы внутри ЦОДа.
- **Мультиплексирование подключений**: PgBouncer и клиентские библиотеки оптимизируют подключения на обоих уровнях.
- **Резервное копирование (для центрального ЦОДа)**:
   - **Глобально**: копии хранятся в разных ЦОДах.
   - **Локально**: локальные копии обеспечивают быстрое восстановление на центральном ЦОДе, а для региональных будем перенаправлять запрос на центральный, который с его данных восстановит его, а пользователь будут обращаться к другому ЦОДу.

> [!IMPORTANT]
> Важно уточнить структуру - есть центральный ЦОД с хранилищем в Москве, у него периодически происходит резервное копирование. Запросы на чтение отправляются в ближайшие ЦОДы, а запись дублируется в ближайший и в центральный, который раз в определенное время рассылает свои данные на другие ЦОДы. Это нужно для поддержания целостности (например товар сначала добавляется в одном ЦОДе и в центральном, а затем рассылается на другие).

---

## 7. Алгоритмы <a name="алгоритмы"></a>

### Персональные рекомендации

#### Сводная таблица

| Алгоритм                       | Область применения                       | Мотивационная часть                                                         |
|--------------------------------|------------------------------------------|-----------------------------------------------------------------------------|
| Коллаборативная фильтрация     | Главная страница, "Похожие товары"       | Простота реализации, высокая точность при наличии данных                    |
| Матричная факторизация         | Главная страница, "Похожие товары"       | Эффективна для больших данных, выявляет скрытые зависимости                 |
| Нейронные сети (Deep Learning) | Главная страница, "Похожие товары"       | Высокая точность, учитывает сложные поведенческие паттерны                  |
| Популярные товары              | Главная страница для новых пользователей | Быстрая реализация, универсальность                                         |
| Контентная фильтрация          | Главная страница для новых пользователей | Работает без данных о других пользователях, опирается на метаданные товаров |
| Ассоциативные правила          | Главная страница для новых пользователей | Увеличивает средний чек за счет кросс-продаж                                |

#### Подробное описание

- **Коллаборативная фильтрация**: этот метод анализирует взаимодействия пользователей с товарами, находя схожие предпочтения. Например, если один пользователь купил спортивную обувь, а другой с похожими вкусами покупал фитнес-аксессуары, система предложит их первому. Алгоритм прост в реализации и эффективен, когда есть достаточный объем данных о взаимодействиях.

- **Матричная факторизация**: разлагает матрицу предпочтений "пользователь-товар" на скрытые факторы, что позволяет предсказывать интерес к товарам. Например, пользователю, любящему электронику с высоким рейтингом, предложат новые устройства с похожими характеристиками. Метод хорош для больших данных и выявления скрытых связей.

- **Нейронные сети (Deep Learning)**: использует сложные модели (например, RNN или Transformer) для анализа последовательностей действий пользователя. Если пользователь смотрел ноутбуки и аксессуары, система может предложить новые модели ноутбуков. Высокая точность и учет поведенческих паттернов делают его мощным инструментом.

- **Популярные товары**: рекомендует товары, которые чаще всего просматривают или покупают. Новому пользователю, например, покажут бестселлеры вроде популярных смартфонов. Это быстрый и универсальный подход для старта.

- **Контентная фильтрация**: сравнивает характеристики товаров, с которыми взаимодействовал пользователь, и предлагает похожие. После просмотра кофемашины могут быть предложены капсулы для кофе. Метод не требует данных о других пользователях, что делает его идеальным для новых клиентов.

- **Ассоциативные правила**: выявляет популярные комбинации товаров в покупках. Если пользователь выбрал телефон, система предложит чехол или наушники, часто покупаемые вместе. Это повышает средний чек через кросс-продажи.

#### Как бы это примерно выглядело для этого проекта:

##### 1. Коллаборативная фильтрация

**Цель:** рекомендовать товары на основе взаимодействий пользователей, находя похожих пользователей или товары.  
**Применение:** главная страница, блок "Похожие товары".

###### Как это работает:
- **Данные:**
   - **ClickHouse:** таблицы `DWH-product-views` (просмотры: `buyer_id`, `product_id`, `timestamp`) и `DWH-purchases` (покупки: `buyer_id`, `product_id`, `quantity`, `price`).
   - **PostgreSQL:** таблицы `review` (отзывы: `buyer_id`, `product_id`, рейтинг) и `rating-product` (оценки товаров).
- **Подготовка:**
   - Собирается матрица "пользователь-товар" из данных просмотров, покупок и отзывов.
   - Значения в матрице могут быть бинарными (1 — взаимодействие, 0 — нет) или взвешенными (например, количество просмотров или рейтинг).
   - ClickHouse быстро агрегирует данные благодаря колоночной структуре и шардированию по `buyer_id` или `product_id`.
- **Алгоритм:**
   - **По пользователям:** находятся похожие пользователи (например, через косинусное сходство), и рекомендуются товары, которые они выбрали, но целевой пользователь еще нет.
   - **По товарам:** находятся похожие товары на основе взаимодействий, и рекомендуются аналоги.
   - Расчеты выполняются в Apache Spark для обработки больших объемов данных.
- **Хранение:** результаты кэшируются в **Redis** (ключ: `buyer_id` или `session_id`, значение: список `product_id` в JSON).
- **Процесс:**
   1. Ежедневно извлекаются данные из ClickHouse и PostgreSQL.
   2. Spark вычисляет рекомендации.
   3. Результаты сохраняются в Redis для быстрого доступа через API.

##### 2. Матричная факторизация
**Цель:** предсказывать предпочтения, разлагая матрицу взаимодействий на скрытые факторы.  
**Применение:** главная страница, "Похожие товары".

###### Как это работает:
- **Данные:** те же, что в коллаборативной фильтрации.
- **Подготовка:** матрица "пользователь-товар" агрегируется в ClickHouse, фокусируясь на ненулевых взаимодействиях.
- **Алгоритм:**
   - Матрица разлагается на две: факторы пользователей (предпочтения) и факторы товаров (характеристики).
   - Используются методы вроде SVD или ALS (чередующиеся наименьшие квадраты).
   - Предсказание — скалярное произведение векторов пользователя и товара.
   - Реализация через Spark MLlib или библиотеку Surprise.
- **Хранение:** рекомендации сохраняются в **Redis** (ключ: `buyer_id`, значение: список `product_id`).
- **Процесс:**
   1. Данные извлекаются из ClickHouse.
   2. Модель обучается оффлайн (ежедневно) в Spark.
   3. Результаты кэшируются в Redis для выдачи через API.

##### 3. Нейронные сети (Deep Learning)
**Цель:** предсказывать предпочтения на основе последовательностей поведения пользователя.  
**Применение:** главная страница, "Похожие товары".

###### Как это работает:
- **Данные:**
   - **ClickHouse:** последовательности просмотров (`DWH-product-views`) и покупок (`DWH-purchases`).
   - **PostgreSQL:** отзывы (`review`) и история пользователя (`Buyer.recommendation_data` в JSONB).
- **Подготовка:** формируются последовательности действий (например, `[view:123, purchase:456]`), извлеченные из ClickHouse.
- **Алгоритм:**
   - Используются RNN/LSTM или трансформеры (например, BERT4Rec) для анализа последовательностей.
   - Вход — закодированные `product_id`, выход — предсказанные товары.
   - Обучение через TensorFlow/PyTorch на GPU.
- **Хранение:** рекомендации в **Redis** для быстрого доступа.
- **Процесс:**
   1. Данные извлекаются из ClickHouse.
   2. Модель обучается оффлайн или обновляется через Kafka.
   3. Результаты кэшируются в Redis и выдаются через API.

##### 4. Популярные товары
**Цель:** рекомендовать самые популярные товары.  
**Применение:** главная страница для новых пользователей.

###### Как это работает:
- **Данные:**
   - **ClickHouse:** просмотры (`DWH-product-views`) и покупки (`DWH-purchases`).
   - **PostgreSQL:** рейтинги (`rating-product`).
- **Подготовка:** агрегация метрик (просмотры, покупки) за последние 30 дней в ClickHouse.
- **Алгоритм:** товары ранжируются по популярности (например, по количеству покупок или взвешенной метрике).
- **Хранение:** топ-N товаров кэшируется в **Redis** (ключ: `popular_products`).
- **Процесс:**
   1. Запросы в ClickHouse формируют список популярных товаров.
   2. Результаты обновляются в Redis каждые 15 минут.

##### 5. Контентная фильтрация
**Цель:** рекомендовать товары, похожие на те, с которыми взаимодействовал пользователь, по их характеристикам.  
**Применение:** главная страница для новых пользователей.

###### Как это работает:
- **Данные:**
   - **PostgreSQL:** метаданные товаров (`product`, `item_features`).
   - **ClickHouse:** история взаимодействий (`DWH-product-views`, `DWH-purchases`).
- **Подготовка:**
   - Создается профиль пользователя на основе характеристик товаров, с которыми он взаимодействовал.
   - Векторы товаров предварительно вычисляются из `item_features`.
- **Алгоритм:** сходство между профилем пользователя и товарами вычисляется (например, косинусное).
- **Хранение:** рекомендации в **Redis** или вычисляются на лету.
- **Процесс:**
   1. Данные о взаимодействиях из ClickHouse, характеристики из PostgreSQL.
   2. Вычисляются рекомендации и кэшируются в Redis.

##### 6. Ассоциативные правила
**Цель:** рекомендовать товары, часто покупаемые вместе.  
**Применение:** кросс-продажи.

###### Как это работает:
- **Данные:**
   - **ClickHouse:** корзины покупок (`DWH-purchases`).
   - **PostgreSQL:** заказы (`order.products` в JSONB).
- **Подготовка:** формируются транзакции (списки товаров из одного заказа).
- **Алгоритм:** применяются Apriori или FP-Growth для поиска правил (например, "если 123, то 456").
- **Хранение:** правила в **Redis** (ключ: `assoc_rules:product_id`).
- **Процесс:**
   1. Данные о корзинах извлекаются из ClickHouse.
   2. Правила вычисляются оффлайн и кэшируются в Redis.

### Модерация контента

#### Сводная таблица

| Алгоритм                                 | Область применения                  | Мотивационная часть                                     |
|------------------------------------------|-------------------------------------|---------------------------------------------------------|
| Наивный байесовский классификатор        | Страницы товаров, раздел отзывов    | Быстрота и простота, подходит для базовой фильтрации    |
| Метод опорных векторов (SVM)             | Страницы товаров, раздел отзывов    | Высокая точность при достаточном объеме данных          |
| Модель BERT                              | Страницы товаров, раздел отзывов    | Максимальная точность для сложных текстов               |
| Сверточные нейронные сети (CNN)          | Добавление новых товаров продавцами | Высокая эффективность в распознавании визуальных данных |
| TF-IDF + Логистическая регрессия         | Добавление новых товаров продавцами | Простота и прозрачность результатов                     |
| Обнаружение аномалий (Anomaly Detection) | Добавление новых товаров продавцами | Выявляет мошенничество или ошибки                       |

#### Подробное описание

- **Наивный байесовский классификатор**: использует вероятностный подход для классификации отзывов на основе частоты слов. Например, отзыв "качественный товар" пройдет, а с нецензурными словами — нет. Быстрота и простота делают его подходящим для базовой модерации.

- **Метод опорных векторов (SVM)**: разделяет отзывы на классы (например, "положительные" или "спам") с помощью гиперплоскости. Подозрительные повторения слов могут быть отнесены к спаму. Высокая точность достигается при достаточном объеме данных.

- **Модель BERT**: анализирует контекст текста, выявляя сложные случаи, такие как сарказм. Отзыв "быстро, как черепаха" может быть отмечен для проверки, в отличие от "очень быстро доставили". Максимальная точность делает его лучшим для сложных текстов.

- **Сверточные нейронные сети (CNN)**: классифицирует изображения товаров, отклоняя неподходящие. Высокая эффективность в работе с визуальными данными идеальна для проверки фото товаров.

- **TF-IDF + Логистическая регрессия**: преобразует описание товара в вектор и классифицирует его. Описания с запрещенными словами (например, "реплика") отклоняются. Метод прост и дает прозрачные результаты.

- **Обнаружение аномалий (Anomaly Detection)**: использует алгоритмы вроде Isolation Forest для поиска подозрительных товаров. Товар с ценой 1 рубль или странным описанием будет отмечен. Это помогает выявлять мошенничество или ошибки.

#### Как бы это примерно выглядело для этого проекта:

##### 1. Наивный байесовский классификатор
**Цель:** фильтрация отзывов на товары для предотвращения публикации спама, оскорблений или недостоверной информации.  
**Применение:** страницы товаров, раздел отзывов.

###### Как это работает:
- **Данные:**
   - Используется база данных **PostgreSQL**, таблица `review` с полями: `buyer_id` (ID покупателя), `product_id` (ID товара), `text` (текст отзыва), `rating` (оценка).
- **Подготовка:**
   - Тексты отзывов извлекаются из таблицы `review`.
   - Текст проходит предобработку: разбиение на слова (токенизация), удаление стоп-слов (например, "и", "в"), приведение слов к базовой форме (стемминг или лемматизация).
   - Данные размечаются вручную или с помощью правил для обучения модели, например, проставляются метки "спам" или "не спам".
- **Алгоритм:**
   - Применяется наивный байесовский классификатор, основанный на теореме Байеса. Он вычисляет вероятность принадлежности текста к определенному классу (например, "спам") на основе частоты встречаемости слов в обучающих данных.
   - Модель обучается на размеченных отзывах, подсчитывая, как часто определенные слова встречаются в спаме или нормальных отзывах.
   - Для нового отзыва модель анализирует текст и предсказывает его класс, опираясь на вычисленные вероятности.
- **Хранение:**
   - Результат классификации записывается обратно в таблицу `review`, например, в новый столбец `is_spam` (булево значение: `true` для спама, `false` для нормального отзыва).
- **Процесс:**
   1. Извлечение текстов отзывов из PostgreSQL.
   2. Предобработка текста (токенизация, очистка, нормализация).
   3. Обучение модели на размеченных данных с использованием библиотеки, например, **scikit-learn**.
   4. Классификация новых отзывов и обновление их статуса в базе данных.

###### Примеры:
- Отзыв "качественный товар, рекомендую" будет классифицирован как "не спам", так как содержит положительные слова и выглядит естественно.
- Отзыв "купить дешево тут: ссылка" или с повторяющимися фразами вроде "товар товар товар" будет отмечен как "спам" из-за подозрительных паттернов.

##### 2. Метод опорных векторов (SVM)
**Цель:** более точная классификация отзывов для выявления спама или нежелательного контента.  
**Применение:** страницы товаров, раздел отзывов.

###### Как это работает:
- **Данные:**
   - Источник — таблица `review` в **PostgreSQL** с полями: `buyer_id`, `product_id`, `text`, `rating`.
- **Подготовка:**
   - Тексты отзывов извлекаются и проходят предобработку: токенизация, удаление стоп-слов, стемминг или лемматизация.
   - Данные размечаются для обучения, например, с метками "положительный", "отрицательный", "спам".
- **Алгоритм:**
   - Метод опорных векторов (SVM) строит гиперплоскость в пространстве признаков, которая максимально разделяет классы (например, "спам" и "не спам").
   - Для текстов признаки создаются с помощью TF-IDF (Term Frequency-Inverse Document Frequency), где каждое слово получает вес в зависимости от его частоты и уникальности.
   - Модель обучается на размеченных данных и затем предсказывает класс для новых отзывов.
- **Хранение:**
   - Результаты классификации записываются в PostgreSQL, например, в столбец `class` таблицы `review` (значения: "положительный", "отрицательный", "спам").
- **Процесс:**
   1. Извлечение текстов отзывов из базы данных.
   2. Предобработка текста и преобразование в TF-IDF векторы.
   3. Обучение SVM на размеченных данных с использованием **scikit-learn**.
   4. Классификация новых отзывов и обновление их статуса в PostgreSQL.

###### Примеры:
- Отзыв "доставка долгая, качество плохое" будет классифицирован как "отрицательный", но не спам, так как содержит конструктивную критику.
- Отзыв с набором случайных символов или ссылками вроде "http://spam.com" будет отмечен как "спам".

##### 3. Модель BERT
**Цель:** высокоточная классификация отзывов с учетом контекста для выявления сложных случаев, таких как сарказм или скрытые оскорбления.  
**Применение:** страницы товаров, раздел отзывов.

###### Как это работает:
- **Данные:**
   - Таблица `review` в **PostgreSQL** с полями: `buyer_id`, `product_id`, `text`, `rating`.
- **Подготовка:**
   - Тексты отзывов извлекаются из базы.
   - Текст токенизируется с использованием специального токенизатора BERT, который разбивает слова на подслова и учитывает контекст.
   - Данные размечаются для дообучения модели, например, с метками "подходит", "требует проверки".
- **Алгоритм:**
   - Используется предобученная модель BERT (Bidirectional Encoder Representations from Transformers), которая дообучается (fine-tuning) на задачу классификации отзывов.
   - BERT анализирует весь контекст предложения, а не только отдельные слова, что позволяет распознавать нюансы вроде сарказма или иронии.
   - Для нового отзыва модель выдает предсказание класса на основе глубокого понимания текста.
- **Хранение:**
   - Результаты классификации сохраняются в PostgreSQL, например, в столбец `moderation_status` (значения: "подходит", "требует проверки").
- **Процесс:**
   1. Извлечение текстов отзывов из PostgreSQL.
   2. Токенизация текста с использованием токенизатора BERT.
   3. Дообучение модели на размеченных данных с помощью библиотеки **Hugging Face Transformers**.
   4. Классификация новых отзывов и обновление их статуса в базе.

###### Примеры:
- Отзыв "доставка быстрая, как черепаха" может быть отмечен как "требует проверки" из-за возможного сарказма.
- Отзыв "все отлично, спасибо" будет классифицирован как "подходит" благодаря явной положительной интонации.

##### 4. Сверточные нейронные сети (CNN)
**Цель:** классификация изображений товаров для предотвращения публикации неподходящего контента.  
**Применение:** добавление новых товаров продавцами.

###### Как это работает:
- **Данные:**
   - Таблица `product` в **PostgreSQL**, где поле `img` (в формате JSONB) содержит ссылки на изображения товаров.
- **Подготовка:**
   - Ссылки на изображения извлекаются из базы данных.
   - Изображения загружаются и предобрабатываются: изменение размера (например, до 224x224 пикселей), нормализация значений пикселей.
   - Данные размечаются для обучения, например, с метками "подходит" или "неподходящее".
- **Алгоритм:**
   - Сверточная нейронная сеть (CNN) обучается на размеченных изображениях, анализируя визуальные паттерны (например, текстуры, цвета, объекты).
   - Модель предсказывает класс для новых изображений на основе выученных признаков.
- **Хранение:**
   - Результаты классификации сохраняются в PostgreSQL, например, в столбец `img_status` (значения: "подходит", "неподходящее").
- **Процесс:**
   1. Извлечение ссылок на изображения из PostgreSQL.
   2. Загрузка и предобработка изображений.
   3. Обучение CNN на размеченных данных с использованием **TensorFlow** или **PyTorch**.
   4. Классификация новых изображений и обновление их статуса в базе.

###### Примеры:
- Изображение с товаром (например, телефона) без нарушений будет классифицировано как "подходит".
- Изображение с рекламным контентом будет отмечено как "неподходящее".

##### 5. TF-IDF + Логистическая регрессия
**Цель:** классификация описаний товаров для предотвращения публикации запрещенных или недопустимых товаров.  
**Применение:** добавление новых товаров продавцами.

###### Как это работает:
- **Данные:**
   - Таблица `product` в **PostgreSQL**, поле `description` (описание товара).
- **Подготовка:**
   - Описания товаров извлекаются из базы.
   - Текст предобрабатывается: токенизация, удаление стоп-слов, приведение к нижнему регистру.
   - Текст преобразуется в TF-IDF векторы, где каждое слово получает вес на основе его частоты и редкости в корпусе.
   - Данные размечаются, например, с метками "подходит" или "запрещено".
- **Алгоритм:**
   - Логистическая регрессия обучается на TF-IDF векторах, определяя вероятность принадлежности описания к классу "запрещено" или "подходит".
   - Модель предсказывает класс для новых описаний на основе выученных закономерностей.
- **Хранение:**
   - Результаты записываются в PostgreSQL, например, в столбец `description_status` (значения: "подходит", "запрещено").
- **Процесс:**
   1. Извлечение описаний товаров из PostgreSQL.
   2. Предобработка текста и векторизация с помощью TF-IDF.
   3. Обучение логистической регрессии на размеченных данных с использованием **scikit-learn**.
   4. Классификация новых описаний и обновление их статуса в базе.

###### Примеры:
- Описание "оригинальный телефон, новый" будет классифицировано как "подходит".
- Описание с запрещенными словами вроде "реплика" будет отмечено как "запрещено".

##### 6. Обнаружение аномалий (Anomaly Detection)
**Цель:** выявление подозрительных товаров, которые могут быть мошенническими или содержать ошибки.  
**Применение:** добавление новых товаров продавцами.

###### Как это работает:
- **Данные:**
   - Таблица `product` в **PostgreSQL** с полями: `price` (цена), `description` (описание), `characteristics` (характеристики).
- **Подготовка:**
   - Извлекаются числовые и текстовые характеристики товаров (например, цена, длина описания, количество изображений).
   - Данные нормализуются, чтобы привести их к единому масштабу.
- **Алгоритм:**
   - Используется алгоритм **Isolation Forest**, который выявляет аномалии, изолируя необычные объекты в данных.
   - Модель обучается на характеристиках товаров и предсказывает, является ли новый товар аномальным.
- **Хранение:**
   - Результаты сохраняются в PostgreSQL, например, в столбец `is_anomaly` (булево значение: `true` для аномалий, `false` для нормальных товаров).
- **Процесс:**
   1. Извлечение характеристик товаров из PostgreSQL.
   2. Нормализация данных.
   3. Обучение Isolation Forest на данных с использованием **scikit-learn**.
   4. Классификация новых товаров и обновление их статуса в базе.

###### Примеры:
- Товар с ценой 1 рубль при средней цене категории 10,000 рублей будет отмечен как аномалия.
- Товар с типичной ценой и описанием будет классифицирован как "нормальный".

---

## 8. Технологии <a name="технологии"></a>

### Языки программирования

| **Технология** | **Область применения**        | **Обоснование**                                                                                                                     |
|----------------|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| **Java**       | Бэкенд                        | Мощный язык для enterprise-приложений, с богатой экосистемой фреймворков и инструментов. Идеален для микросервисов.                 |
| **TypeScript** | Фронтенд                      | Статическая типизация для масштабируемых проектов, снижение ошибок на этапе разработки. Идеален для SPA и большой команды.          |
| **Kotlin**     | Мобильное приложение Android  | Статически типизированный язык на JVM. Устранение ошибок вроде null-pointer exceptions, поддержка функционального программирования. |
| **Swift**      | Мобильное приложение iOS      | Мощный и интуитивный язык от Apple. Современные функции, безопасность и производительность для iOS-приложений.                      |
| **Python**     | Машинное обучение, аналитика  | Простота синтаксиса и богатая экосистема библиотек (NumPy, Pandas, TensorFlow) для работы с данными и моделями ML.                  |

### Базы данных и хранилища

| **Технология**    | **Область применения**            | **Обоснование**                                                                                                                                                                                          |
|-------------------|-----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Redis**         | Кэширование                       | Хранилище в памяти с поддержкой структур данных (списки, множества). Высокая производительность, репликация, TTL для автоматического удаления устаревших данных. Используется для сессий и кэша корзины. |
| **PostgreSQL**    | Основная база данных (транзакции) | Реляционная СУБД с поддержкой ACID, сложных запросов и JSONB для гибкости. Подходит для заказов, пользователей и инвентаря, где важна целостность.                                                       |
| **Elasticsearch** | Поисковый движок                  | Распределенная система для полнотекстового поиска. Быстрый поиск по товарам, поддержка фильтров.                                                                                                         |
| **ClickHouse**    | OLAP-хранилище                    | Столбцовая СУБД для аналитики в реальном времени. Быстрая обработка больших данных (миллионы вставок/сек), поддержка SQL и агрегаций. Используется для DWH.                                              |
| **AWS S3**        | Хранилище файлов и бэкапов        | Облачное хранилище с высокой доступностью и автоматической репликацией. Для хранения изображений товаров и резервных копий.                                                                              |
| **InfluxDB**      | Хранилище логов и временных рядов | Оптимизирована для метрик и логов в реальном времени. Анализ трендов и аномалий (например, нагрузка на серверы).                                                                                         |
| **PgBouncer**     | Пулинг соединений PostgreSQL      | Уменьшает нагрузку на БД за счет пулинга подключений. Критичен для высоконагруженных систем. Поддержка транзакционного/сессионного режимов.                                                              |


### Протоколы и API

| **Технология**            | **Область применения**                                    | **Обоснование**                                                                                                                                                                  |
|---------------------------|-----------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **WebSocket**             | Реал-тайм обновления (уведомления, чат, трекинг заказов)  | Двусторонняя связь для мгновенных обновлений. Интеграция с Spring Boot через **STOMP** и **SockJS**. Подходит для уведомлений о статусе заказов и онлайн-поддержки.              |
| **gRPC**                  | Внутренняя коммуникация микросервисов                     | Высокая производительность за счет HTTP/2 и бинарного формата **Protocol Buffers**. Идеален для критичных к задержкам сервисов.                                                  |
| **REST API (HTTP/HTTPS)** | Внешние и внутренние API                                  | Стандарт для интеграции с фронтендом и партнерами. **HTTPS** обеспечивает безопасность данных. Реализация через **Spring Web** с поддержкой HATEOAS и документацией **Swagger**. |
| **SOAP**                  | Интеграция с банками и legacy-системами                   | Поддержка XML-формата для взаимодействия с внешними платежными шлюзами и корпоративными системами. Реализация через **Apache CXF** в Java.                                       |


### Фреймворки и библиотеки

| **Технология**                  | **Область применения**       | **Обоснование**                                                                                                                         |
|---------------------------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| **Spring Boot**                 | Бэкенд                       | Популярный фреймворк для Java, упрощает разработку микросервисов, включает модули для различных задач.                                  |
| **Hibernate**                   | ORM для PostgreSQL           | Мощный ORM для работы с реляционными базами данных в Java.                                                                              |
| **Liquibase**                   | Управление миграциями БД     | Инструмент для версионирования схемы базы данных и управления изменениями в PostgreSQL.                                                 |
| **Spring Cache**                | Кэширование                  | Интеграция с Redis для кэширования данных в Java-приложениях.                                                                           |
| **Elasticsearch Java API**      | Поиск                        | Официальный Java-клиент для работы с Elasticsearch.                                                                                     |
| **ClickHouse JDBC**             | Аналитика                    | JDBC-драйвер для подключения к ClickHouse из Java.                                                                                      |
| **Java Advanced Imaging (JAI)** | Обработка изображений        | Библиотека для обработки изображений в Java.                                                                                            |
| **Apache Commons Math**         | Математические вычисления    | Библиотека для линейной алгебры и других математических задач в Java.                                                                   |
| **React**                       | Фронтенд                     | Библиотека для SPA с Virtual DOM, компонентами и высокой производительностью. Подходит для динамичных интерфейсов e-commerce.           |
| **PyTorch**                     | Машинное обучение            | Гибкая библиотека для нейронных сетей. Используется для персонализации и обработки изображений (включая CLIP).                          |
| **TensorFlow**                  | Машинное обучение            | Библиотека для построения моделей ML, включая рекомендации и обработку изображений.                                                     |
| **OpenCV**                      | Обработка изображений        | Библиотека компьютерного зрения для анализа изображений товаров (например, в связке с CLIP).                                            |
| **spaCy**                       | Обработка текста (NLP)       | Продвинутая библиотека для анализа текста (токенизация, NER). Замена NLTK для сложных задач, таких как анализ отзывов или рекомендаций. |
| **NumPy**                       | Аналитика, ML                | Работа с массивами, основа для Pandas и TensorFlow.                                                                                     |
| **Pandas**                      | Анализ данных                | Работа с данными пользователей (фильтрация, группировка). Интеграция с ML-библиотеками для подготовки данных.                           |
| **Spring WebSocket**            | Реал-тайм обновления         | Интеграция с STOMP для управления сообщениями. Поддержка сессий и брокера сообщений (Kafka).                                            |
| **gRPC Java**                   | Микросервисная коммуникация  | Генерация клиентов и серверов на основе .proto-файлов. Совместимость с Kubernetes для service discovery.                                |
| **Apollo GraphQL**              | Гибкие API для клиентов      | Оптимизация запросов к каталогу товаров. Интеграция с Spring Boot через graphql-java.                                                   |
| **Protocol Buffers**            | Сериализация данных для gRPC | Эффективный бинарный формат для передачи данных между микросервисами. Снижает нагрузку на сеть.                                         |
| **Next.js**                     | SSR для фронтенда            | Серверный рендеринг React-приложений для SEO и быстрой первоначальной загрузки. Интеграция с бэкендом на Spring Boot через API.         |
| **Single-SPA**                  | Микрофронтенды               | Оркестрация независимо разрабатываемых модулей (каталог, корзина, ЛК, ...). Поддержка lazy loading и изоляции стилей/скриптов.          |

### Инструменты

| **Технология**     | **Область применения**       | **Обоснование**                                                                                                                |
|--------------------|------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| **Prometheus**     | Сбор метрик                  | Система мониторинга временных рядов с языком PromQL. Интеграция с Grafana для визуализации производительности.                 |
| **Docker**         | Контейнеризация              | Упаковка приложений с зависимостями. Упрощает развертывание и тестирование в разных средах.                                    |
| **Kubernetes**     | Оркестрация контейнеров      | Автоматизация масштабирования и управления контейнерами. Self-healing, auto-scaling и управление секретами для микросервисов.  |
| **Nginx**          | Балансировка нагрузки L7     | Высокопроизводительный веб-сервер и обратный прокси. SSL-терминация и маршрутизация трафика внутри ЦОДа.                       |
| **HAProxy**        | Балансировка нагрузки L4/L7  | Распределение TCP/HTTP-трафика, health checks, SSL termination. Для микросервисов, БД и Kafka.                                 |
| **Apache Kafka**   | Брокер сообщений             | Потоковая обработка данных (аналитика, очереди). Высокая пропускная способность (миллионы сообщений/сек) и отказоустойчивость. |
| **GitHub**         | Контроль версий, CI/CD       | Хостинг кода, pull requests и встроенные GitHub Actions для автоматизации CI/CD.                                               |
| **Linkerd**        | Сервисная mesh               | Управление трафиком, шифрование и мониторинг в микросервисах без изменения кода.                                               |
| **Cloudflare**     | CDN, доставка контента       | Быстрая доставка статического контента через глобальную сеть. Защита от DDoS и оптимизация загрузки страниц.                   |
| **Terraform**      | Инфраструктура как код (IaC) | Автоматизация управления облачной инфраструктурой (AWS). Упрощает развертывание ЦОДов.                                         |
| **Kong Gateway**   | API-менеджмент               | Маршрутизация, аутентификация и мониторинг для REST/gRPC API. Интеграция с Prometheus для сбора метрик.                        |

### Инструменты управления проектами и коммуникации

| **Технология**        | **Область применения**   | **Обоснование**                                          |
|-----------------------|--------------------------|----------------------------------------------------------|
| **Jira**              | Управление задачами      | Поддержка Agile и Waterfall, отслеживание задач и багов. |
| **Confluence**        | Документация             | Хранение знаний и документации.                          |
| **Trello**            | Канбан-доски             | Управление задачами в Agile.                             |
| **Microsoft Project** | Планирование (Waterfall) | Диаграммы Ганта для сложных проектов.                    |
| **Slack**             | Чаты                     | Коммуникация и интеграции.                               |
| **Zoom**              | Видеоконференции         | Совещания и встречи.                                     |
| **Resource Guru**     | Управление ресурсами     | Планирование загрузки специалистов.                      |

### Технологии для аналитиков и дизайн

| **Технология** | **Область применения**           | **Обоснование**                                                                                                                   |
|----------------|----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| **Draw.io**    | UML, BPMN диаграммы              | Визуализация процессов и архитектуры.                                                                                             |
| **drawDB**     | Моделирование баз данных         | Проектирование схем баз данных.                                                                                                   |
| **Tableau**    | Визуализация данных              | Интерактивные дашборды для аналитики.                                                                                             |
| **Figma**      | Проектирование UI/UX интерфейсов | Инструмент для создания макетов, прототипов и дизайн-систем. Коллаборация в режиме реального времени, интеграция с Zeplin и Jira. |

### Платформы для QA

| **Технология** | **Область применения**          | **Обоснование**                                                                |
|----------------|---------------------------------|--------------------------------------------------------------------------------|
| **TestRail**   | Тест-кейсы                      | Управление тестированием.                                                      |
| **Bugzilla**   | Баг-репорты                     | Отслеживание ошибок.                                                           |
| **Selenium**   | E2E-тестирование                | Автоматизация браузерных тестов для проверки взаимодействия с веб-приложением. |
| **Postman**    | API-тестирование                | Тестирование API, отправка запросов и проверка ответов.                        |
| **Swagger**    | Документация и тестирование API | Генерация интерактивной документации и клиентских SDK для API.                 |
| **JMeter**     | Нагрузочное тестирование        | Имитация большого количества пользователей для проверки производительности.    |
| **Gatling**    | Нагрузочное тестирование        | Создание сложных сценариев нагрузочного тестирования и анализ результатов.     |


### Технологии для акционеров и экономистов

| **Технология**    | **Область применения**   | **Обоснование**                                                                                      |
|-------------------|--------------------------|------------------------------------------------------------------------------------------------------|
| **SAP ERP**       | Финансовый учет          | Комплексное решение для крупных проектов.                                                            |
| **Excel (с VBA)** | Анализ и прогнозирование | Гибкий инструмент для экономистов: построение моделей, прогнозирование, работа с небольшими данными. |

### Анализ логов

| **Технология**    | **Область применения** | **Обоснование**                                                                                  |
|-------------------|------------------------|--------------------------------------------------------------------------------------------------|
| **Apache NiFi**   | Работа с логами        | Позволяет автоматизировать потоки данных, включая удаление или анонимизацию логов по расписанию. |
| **Splunk**        | Анализ логов           | Продвинутый анализ для разных задач.                                                             |
| **Grafana**       | Визуализация           | Дашборды для логов и метрик.                                                                     |

### Таблица для безопасности

| **Технология**          | **Область применения**    | **Обоснование**                                                                            |
|-------------------------|---------------------------|--------------------------------------------------------------------------------------------|
| **SonarQube**           | Статический анализ кода   | Выявление уязвимостей и ошибок в коде на ранних этапах разработки.                         |
| **Checkmarx**           | Статический анализ кода   | Анализ безопасности кода для предотвращения уязвимостей.                                   |
| **Burp Suite**          | Динамический анализ       | Тестирование безопасности веб-приложений, обнаружение уязвимостей.                         |
| **AWS Secrets Manager** | Управление секретами      | Управление секретами в облаке AWS с интеграцией в инфраструктуру.                          |
| **Vault**               | Хранилище секретов        | Управление паролями, ключами и сертификатами. Шифрование данных и гибкие политики доступа. |
| **Nessus**              | Соответствие стандартам   | Сканирование уязвимостей и проверка соответствия политикам безопасности.                   |


### Специфические технологии для задач

| **Технология**               | **Область применения**     | **Обоснование**                                                                            |
|------------------------------|----------------------------|--------------------------------------------------------------------------------------------|
| **TensorFlow Recommenders**  | Рекомендательные системы   | Фреймворк для персонализированных рекомендаций с использованием глубокого обучения.        |
| **Google Cloud Vision API**  | Модерация изображений      | Анализ изображений для обнаружения объектов и неподходящего контента.                      |
| **Apache Hive**              | DWH и аналитика            | SQL-запросы к большим данным в распределенных системах (по типу Hadoop).                   |
| **PostGIS**                  | Геопространственные данные | Расширение PostgreSQL для работы с геоданными (достаточно для большинства задач доставки). |
| **H3**                       | Геопространственные данные | Система геокодирования от Uber для индексирования и запросов геоданных.                    |
| **Isolation Forest**         | Борьба с мошенничеством    | Алгоритм ML для обнаружения аномалий в данных.                                             |
| **FraudLabs Pro**            | Борьба с мошенничеством    | Сервис для предотвращения мошенничества в платежах и заказах.                              |

---

## 9. Обеспечение надёжности <a name="обеспечение-надёжности"></a>

### Сводная таблица по компонентам системы

| **Компонент**      | **Описание**                      | **Методы резервирования**                             | **Воздействие на надежность**                                                             |
|--------------------|-----------------------------------|-------------------------------------------------------|-------------------------------------------------------------------------------------------|
| **Git**            | Система контроля версий           | Резервные репозитории, распределенные клоны           | Восстановление версий и откат изменений сохраняют стабильность при обновлениях.           |
| **Jenkins**        | Сервер автоматизации CI/CD        | Конфигурация master-slave, failover                   | Автоматизация с отказоустойчивостью минимизирует простои при развертывании.               |
| **SonarQube**      | Анализ статического кода          | Резервные экземпляры, репликация БД                   | Раннее выявление ошибок повышает качество кода и устойчивость системы.                    |
| **TestRail**       | Управление тест-кейсами           | Облачные бэкапы, резервные серверы                    | Полное покрытие тестирования предотвращает сбои перед продакшеном.                        |
| **Swagger**        | Документация и тестирование API   | Версионные бэкапы, резервирование шлюза API           | Надежность API критически важна для микросервисов при высокой нагрузке.                   |
| **Postman/Newman** | Инструменты тестирования API      | Автоматические бэкапы тестов, облачное хранение       | Проверка API под нагрузкой обеспечивает устойчивость конечных точек.                      |
| **Checkmarx**      | Сканирование безопасности кода    | Резервные сканирования, бэкапы отчетов                | Устранение рисков безопасности предотвращает сбои из-за эксплойтов.                       |
| **Terraform**      | Инфраструктура как код (IaC)      | Бэкапы state-файлов, многорегиональное-развертывание  | Масштабируемость и отказоустойчивость между регионами.                                    |
| **Docker**         | Контейнеризация                   | Репликация реестра образов                            | Согласованность сред снижает сбои при развертывании.                                      |
| **Helm**           | Менеджер пакетов Kubernetes       | Управление версиями чартов, резервные чарты           | Упрощает масштабируемые развертывания и восстановление.                                   |
| **Kubernetes**     | Оркестрация контейнеров           | Многоузловые кластеры, автоскалирование, репликация   | Самовосстановление и балансировка нагрузки для работы под высокой нагрузкой.              |
| **Burp Suite**     | Сканер уязвимостей веб-приложений | Запланированные сканирования, архивация отчетов       | Защита от угроз гарантирует доступность системы.                                          |
| **JMeter**         | Нагрузочное тестирование          | Бэкапы тестовых скриптов, распределенное тестирование | Оптимизация под высокий трафик предотвращает перегрузки.                                  |
| **Gatling**        | Тестирование производительности   | Бэкапы тестовых сценариев, выполнение в облаке        | Анализ производительности для стабильности при пиковых нагрузках.                         |
| **Nessus**         | Оценка уязвимостей                | Резервные сканирования, централизованная отчетность   | Снижение рисков сбоев из-за уязвимостей.                                                  |
| **Bugzilla**       | Отслеживание ошибок               | Репликация БД, облачные бэкапы                        | Быстрое устранение проблем повышает время безотказной работы.                             |
| **PostgreSQL**     | Основная база данных              | Репликация, WAL, pg_basebackup                        | Целостность данных и быстрое восстановление для заказов и пользователей при сбоях.        |
| **Redis**          | Кэширование                       | Репликация, AOF/RDB                                   | Быстрый доступ к данным сессий и корзины снижает нагрузку на основную БД.                 |
| **Elasticsearch**  | Поисковый движок                  | Репликация шардов, снапшоты                           | Отказоустойчивый поиск по товарам для стабильного пользовательского опыта.                |
| **ClickHouse**     | OLAP-хранилище                    | Репликация, шардирование                              | Аналитика в реальном времени с высокой производительностью и устойчивостью.               |
| **Prometheus**     | Мониторинг метрик                 | Федерация, резервные экземпляры                       | Федерация собирает метрики из разных источников, проактивно выявляя проблемы.             |
| **InfluxDB**       | Хранилище логов и временных рядов | Репликация, бэкапы                                    | Сбор и надежное хранение логов для анализа и устранения неполадок.                        |
| **Vault**          | Управление секретами              | Репликация, бэкапы                                    | Безопасное хранение секретов предотвращает утечки и обеспечивает доступность данных.      |
| **Cloudflare**     | CDN, WAF, защита от DDoS          | Глобальная сеть, автоматическое переключение          | Ускорение контента, защита от атак и снижение нагрузки на серверы при highload-сценариях. |

### Как добавление компонентов усиливает надежность

1. **Базы данных (PostgreSQL, Redis, Elasticsearch, ClickHouse)**
    - Репликация, WAL (PostgreSQL), AOF/RDB (Redis), снапшоты (Elasticsearch) и шардирование (ClickHouse) обеспечивают целостность данных и быстрое восстановление. Это критично для сохранения заказов, сессий и аналитики при сбоях.

2. **Сбор метрик (Prometheus)**
    - Федерация Prometheus позволяет собирать метрики из разных источников, обеспечивая быстрое выявление проблем. Резервные экземпляры повышают доступность мониторинга.

3. **Сбор логов (InfluxDB)**
    - Репликация и бэкапы InfluxDB гарантируют надежное хранение логов и временных рядов, что помогает в диагностике и устранении сбоев, сохраняя стабильность системы.

4. **Работа с секретами (Vault)**
    - Vault с репликацией и бэкапами обеспечивает безопасное управление секретами, предотвращая утечки и гарантируя доступность критичных данных для сервисов.

5. **Cloudflare (CDN, WAF, защита от DDoS)**
    - CDN ускоряет доставку контента, WAF защищает от веб-атак, а защита от DDoS снижает нагрузку на серверы и предотвращает сбои при высоком трафике или атаках.

6. **Автоматизация тестирования (SonarQube, TestRail, Selenium)**
    - Интеграция этих инструментов обеспечивает проверку качества кода и end-to-end тестирование. Раннее обнаружение ошибок и тестирование под нагрузкой (включая сценарии с Selenium) минимизируют сбои в production, что критично для стабильности при высоком трафике.

7. **Усиление безопасности (Checkmarx, Burp Suite, Nessus)**
    - Многоуровневые проверки безопасности защищают систему от атак, которые могут привести к масштабным сбоям. Это особенно важно для высоконагруженных систем, где уязвимости могут быть использованы для нарушения работы.

8. **Масштабируемость инфраструктуры (Terraform, Kubernetes)**
    - Terraform позволяет развертывать инфраструктуру в нескольких регионах, а Kubernetes обеспечивает автоскалирование и самовосстановление. Это качественно повышает отказоустойчивость, позволяя системе справляться с ростом нагрузки и восстанавливаться после сбоев.

9. **Оптимизация производительности (JMeter, Gatling)**
    - Инструменты нагрузочного тестирования моделируют пиковый трафик, позволяя настроить систему для предотвращения перегрузок. Это гарантирует стабильный пользовательский опыт даже при резких скачках спроса.

10. **Автоматизация CI/CD (Jenkins, Docker, Helm)**
    - Автоматизация конвейера с использованием контейнеров и оркестрации снижает ошибки развертывания и ускоряет обновления. Это обеспечивает быструю и надежную доставку изменений, что важно для непрерывной работы под нагрузкой.

### Дополнительные аспекты надежности

- **Глобальная балансировка нагрузки**: использование GeoDNS и BGP Anycast направляет трафик к ближайшим ЦОДам, снижая задержки и повышая доступность. Failover-механизмы перераспределяют нагрузку при сбоях, что критично для highload-сценариев.
- **Локальная балансировка**: внутри ЦОДов NGINX (в том числе, между машинными залами) и Kubernetes распределяют запросы, исключая перегрузку отдельных узлов и обеспечивая бесперебойную работу.
- **Резервное копирование**: регулярные бэкапы (полные и инкрементные) для PostgreSQL, Redis, ClickHouse и Elasticsearch гарантируют восстановление данных после сбоев, минимизируя потери.
- **Graceful Shutdown**: реализован для микросервисов и балансировщиков нагрузки, чтобы релизы и перезагрузки не влияли на пользователей. Сервисы завершают текущие запросы, не принимая новые, что предотвращает ошибки при обновлениях.
- **Graceful Degradation**: система сохраняет частичную функциональность при сбоях, с приоритетом на критичные функции (каталог, заказы), используя Circuit Breaker и fallback-механизмы. Это позволяет поддерживать работоспособность ключевых сервисов при отказе неосновных компонентов.
- **Асинхронные паттерны**: CQRS и Event-Sourcing применяются для управления данными, а Saga — для координации распределенных транзакций. Это обеспечивает консистентность данных и устойчивость системы к сбоям.
- **Обработка отказов**: Circuit Breaker и перезапросы (retries) повышают устойчивость системы к временным сбоям, предотвращая перегрузку и каскадные ошибки.
- **Резервирование логики**: для неосновных функций используется упрощенная логика или кэшированные данные при сбоях. Для критичных сервисов (заказы, оплата) применяется полное резервирование, так как упрощенная логика не обеспечивает целостность данных.

---

## 10. Схема проекта <a name="схема-проекта"></a>

Схему ci/cd можно посмотреть по этой ссылке: [https://draft.io/xf92qudd3v49jurncg2ynqrez3fprnwmbegtnd62m7pd](https://draft.io/xf92qudd3v49jurncg2ynqrez3fprnwmbegtnd62m7pd)

![ci_cd ozon.png](img%2F10%2Fimg_1.png)

Схему проекта без сбора логов и метрик можно посмотреть по этой ссылке: [https://draft.io/vg5t2xtmnahttjma2yhg8ea5y3u8djtcqkkuf4nf7fdy](https://draft.io/vg5t2xtmnahttjma2yhg8ea5y3u8djtcqkkuf4nf7fdy)

![ozon without logs and metrics.png](img%2F10%2Fimg_2.png)

Схему фронтенда можно посмотреть по ссылке: [https://draft.io/87446tjyseaauqazdrku2f29f2y4h3dxwcwxj8h7fz7u](https://draft.io/87446tjyseaauqazdrku2f29f2y4h3dxwcwxj8h7fz7u)

![Frontend SSR Server.png](img%2F10%2Fimg.png)

Основную схему проекта со сбором логов и метрик можно посмотреть по ссылке: [https://draft.io/qpezn93ekwybh98xdmy4x65qq6xurzae8eyfn5uaasys](https://draft.io/qpezn93ekwybh98xdmy4x65qq6xurzae8eyfn5uaasys)

![ozon.png](img%2F10%2Fimg_3.png)

---

## 11. Список серверов <a name="список-серверов"></a>

Для поддержки микросервисов (аналитика, продавец, поиск, продукт, профиль, рекомендации, авторизация, заказы, отзывы) была проведена оценка пиковой нагрузки (RPS), рассчитаны ресурсы для Kubernetes, определены stateful-сервисы и сформирован итоговый список серверов.

### Оценка нагрузки на микросервисы (используем пункт 2)

Пиковая нагрузка (RPS) для каждого микросервиса:

- **Продукт**: ~310347,1 RPS
    - Просмотр товаров: 14656,56 RPS
    - Подгрузка изображений: 293131,2 RPS
    - Просмотр страницы товаров: 1854,06 RPS
    - Изменение корзины: 705,27 RPS
- **Поиск**: 1165,51 RPS
- **Профиль**: ~744,9 RPS
    - Просмотр истории заказов: 527 RPS
    - Изменение данных: 7 RPS
    - Новый заказ: 210,85 RPS
- **Заказы**: ~422 RPS
    - Оформление заказов: 210,85 RPS
    - Просмотр корзины: 211 RPS
- **Отзывы**: ~4949 RPS
    - Просмотр отзывов: 4944 RPS
    - Добавление отзывов: 4,73 RPS
- **Рекомендации**: ~5365 RPS
    - Просмотр страницы товаров: 1854,06 RPS
    - Каталог: 2345,05 RPS
    - Использование поиска: 1165,51 RPS
- **Продавец**: ~10 RPS
    - Добавление товара: 9,98 RPS
- **Аналитика**: ~17 RPS
- **Авторизация**: ~3,72 RPS
    - Регистрация: 1,77 RPS
    - Авторизация: 1,95 RPS

Суммарная пиковая нагрузка: **~323024 RPS**.

### Расчет ресурсов для Kubernetes

Микросервисы реализованы на Java (Spring Boot) с умеренной бизнес-логикой. Для одного пода приняты следующие параметры:
- **RPS на под**: 100 запросов в секунду
- **CPU на под**: 1 ядро [^33]
- **RAM на под**: 1 ГБ (request), 2 ГБ (limit) [^34]

#### Расчет по микросервисам

1. **Продукт**:
- Нагрузка: 310347,1 RPS
- Поды: 310347,1 / 100 ≈ 3103,47 → **3104 пода**
- CPU: **3104 ядра**
- RAM: **3104 ГБ (request)**, **6208 ГБ (limit)**

2. **Поиск**:
- Нагрузка: 1165,51 RPS
- Поды: 1165,51 / 100 ≈ 11,66 → **12 подов**
- CPU: **12 ядер**
- RAM: **12 ГБ (request)**, **24 ГБ (limit)**

3. **Профиль**:
- Нагрузка: 744,9 RPS
- Поды: 744,9 / 100 ≈ 7,45 → **8 подов**
- CPU: **8 ядер**
- RAM: **8 ГБ (request)**, **16 ГБ (limit)**

4. **Заказы**:
- Нагрузка: 422 RPS
- Поды: 422 / 100 ≈ 4,22 → **5 подов**
- CPU: **5 ядер**
- RAM: **5 ГБ (request)**, **10 ГБ (limit)**

5. **Отзывы**:
- Нагрузка: 4949 RPS
- Поды: 4949 / 100 ≈ 49,49 → **50 подов**
- CPU: **50 ядер**
- RAM: **50 ГБ (request)**, **100 ГБ (limit)**

6. **Рекомендации**:
- Нагрузка: 5365 RPS
- Поды: 5365 / 100 ≈ 53,65 → **54 пода**
- CPU: **54 ядра**
- RAM: **54 ГБ (request)**, **108 ГБ (limit)**

7. **Продавец**:
- Нагрузка: 10 RPS
- Поды: 10 / 100 ≈ 0,1 → **1 под**
- CPU: **1 ядро**
- RAM: **1 ГБ (request)**, **2 ГБ (limit)**

8. **Аналитика**:
- Нагрузка: 17 RPS
- Поды: 17 / 100 ≈ 0,17 → **1 под**
- CPU: **1 ядро**
- RAM: **1 ГБ (request)**, **2 ГБ (limit)**

9. **Авторизация**:
- Нагрузка: 3,72 RPS
- Поды: 3,72 / 100 ≈ 0,04 → **1 под**
- CPU: **1 ядро**
- RAM: **1 ГБ (request)**, **2 ГБ (limit)**

#### Общие ресурсы

- **Общее количество подов**: 3104 + 12 + 8 + 5 + 50 + 54 + 1 + 1 + 1 = **3236 подов**
- **CPU**: **3236 ядер**
- **RAM**: **3236 ГБ (request)**, **6472 ГБ (limit)**

### Серверы для Kubernetes

Используем bare-metal серверы с конфигурацией:
- **64 ядра, 256 ГБ RAM, 2xNVMe 4TB, 2x25Gb/s сеть**.

#### Ограничения одного сервера

- **По CPU**: 64 ядра → 64 пода
- **По RAM (request)**: 256 ГБ / 1 ГБ = 256 подов
- **По RAM (limit)**: 256 ГБ / 2 ГБ = 128 подов

Лимитирующий фактор — CPU: **64 пода на сервер**.
- RAM: 64 × 1 ГБ = 64 ГБ (request), 64 × 2 ГБ = 128 ГБ (limit) — вписывается в 256 ГБ.

#### Учет резерва и overhead

Резерв для Kubernetes и системы: 10% ресурсов.
- **Полезные ядра**: 64 × 0,9 ≈ **57 ядер**
- **Полезная RAM**: 256 × 0,9 ≈ 230,4 ГБ
    - Request: 230,4 / 1 ≈ 230 подов
    - Limit: 230,4 / 2 ≈ 115 подов

С учетом CPU: **57 подов на сервер**.

#### Количество серверов

- **Всего подов**: 3236
- **Подов на сервер**: 57
- **Серверов без резерва**: 3236 / 57 ≈ 56,77 → **57 серверов**
- **С резервом 20%**: 57 × 1,2 ≈ 68,4 → **69 серверов**

### Веб-серверы (Nginx)

Прошлогодний расчет учитывал Nginx для обработки трафика.
- **Производительность Nginx**: 77427 RPS на сервер с 16 CPU.
- **Пиковая нагрузка**: 323024 RPS (обновленные данные).
- **Серверов по RPS**: 323024 / 77427 ≈ 4,17 → **5 серверов**.
- **Сетевой трафик**: допустим, 2,5 Гбит/с (как в прошлом году).
    - 1 сервер: 40 Гбит/с → 2,5 / 40 = 0,06 → **1 сервер**.

С учетом резерва (1+1 на ДЦ) и 4 дата-центров:
- **Всего Nginx-серверов**: 5 × 2 × 4 = **40 серверов**.

Конфигурация: **16 CPU, 32 ГБ RAM**.

### Stateful-сервисы

#### Для фронтенда
- **8 Redis** (кэширование для фронтенда, например, для сессий, кэша страниц):
    - **Логическое количество**: 8 Redis (возможно, для разных типов данных или микросервисов, таких как сессии, кэш страниц, корзины).
    - **Физическое количество**: для хайлоада предположим кластер с репликацией (3 master + 3 replica на кластер) и распределением по 4 дата-центрам. Если объединить в один кластер, то:
        - **5 машин** (3 master + 2 replica) на дата-центр × 4 ДЦ = **20 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 1TB SSD (как в исходном расчете для Redis).
    - **Обоснование**: отдельные 8 Redis могут быть избыточными для фронтенда, так как данные (сессии, кэш) можно разделить по ключам в одном кластере. Единый кластер на 20 машин обеспечивает высокую производительность и отказоустойчивость.

#### Для бэкенда
- **5 PostgreSQL** (хранение данных для профилей, заказов, продуктов, отзывов):
    - **Логическое количество**: 5 баз, вероятно, для разных микросервисов (например, профиль, заказы, продукты, отзывы, продавец).
    - **Физическое количество**: для хайлоада каждый PostgreSQL-кластер должен иметь репликацию (1 master + 2 replica). Предположим 5 кластеров:
        - 5 кластеров × (1 master + 2 replica) = 15 машин на ДЦ.
        - С учетом 4 ДЦ: 15 × 4 = **60 машин**.
        - **Конфигурация**: 32 ядра, 128 ГБ RAM, 2TB SSD.
    - **Обоснование**: исходный расчет предполагал 10 машин для MVP с кэшированием, но для хайлоада и явного указания 5 PostgreSQL логично выделить отдельные кластеры. Это увеличит количество машин, но обеспечит изоляцию и производительность.

- **1 ClickHouse** (аналитика):
    - **Логическое количество**: 1 кластер для аналитики.
    - **Физическое количество**: для хайлоада нужен кластер с репликацией и шардированием (например, 4 узла на ДЦ). С учетом 4 ДЦ:
        - 4 узла × 4 ДЦ = **16 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 2TB SSD.
    - **Обоснование**: ClickHouse оптимизирован для аналитики, и 16 машин обеспечивают масштабируемость для больших объемов данных.

- **3 Redis** (кэширование для бэкенда):
    - **Логическое количество**: 3 Redis, возможно, для разных микросервисов (например, заказы, продукты, рекомендации).
    - **Физическое количество**: если объединить в один кластер, то:
        - 5 машин (3 master + 2 replica) на ДЦ × 4 ДЦ = **20 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 1TB SSD.
    - **Обоснование**: как и для фронтенда, объединение в один кластер с разделением данных по ключам экономично и достаточно для хайлоада.

- **1 Elasticsearch** (поиск по товарам):
    - **Логическое количество**: 1 кластер для поиска.
    - **Физическое количество**: для хайлоада нужен кластер с репликацией (например, 3 узла на ДЦ). С учетом 4 ДЦ:
        - 3 узла × 4 ДЦ = **12 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 2TB SSD.
    - **Обоснование**: Elasticsearch требует высокой производительности для полнотекстового поиска, и 12 машин обеспечивают отказоустойчивость.

- **3 Amazon S3** (хранилище для изображений, файлов):
    - **Логическое количество**: 3 S3, возможно, для разных типов данных (изображения, документы, логи).
    - **Физическое количество**: Amazon S3 — это объектное хранилище, и физически оно не требует отдельных серверов, но для хайлоада можно использовать 3 логических бакета в одном S3-кластере. Для расчета предположим эквивалент 3 машин на ДЦ для обработки запросов (например, через шлюзы):
        - 3 машины × 4 ДЦ = **12 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 2TB SSD (для шлюзов или кэширования).
    - **Обоснование**: один S3-кластер с несколькими бакетами обычно достаточно, но для хайлоада учтем дополнительные машины для обработки запросов.

- **7 Kafka** (очереди сообщений, аналитика):
    - **Логическое количество**: 7 кластеров, возможно, для разных потоков событий (аналитика, заказы, рекомендации).
    - **Физическое количество**: для хайлоада объединим в один кластер с большим числом брокеров (например, 7 брокеров на ДЦ). С учетом 4 ДЦ:
        - 7 брокеров × 4 ДЦ = **28 машин**.
        - **Конфигурация**: 32 ядра, 128 ГБ RAM, 2TB SSD.
    - **Обоснование**: объединение в один кластер с разделением по топикам эффективно, а 28 машин обеспечивают высокую пропускную способность.

- **1 Splunk** (логирование):
    - **Логическое количество**: 1 кластер для логов.
    - **Физическое количество**: для хайлоада нужен кластер с репликацией (например, 3 узла на ДЦ). С учетом 4 ДЦ:
        - 3 узла × 4 ДЦ = **12 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 2TB SSD.
    - **Обоснование**: Splunk требует ресурсов для обработки логов, и 12 машин обеспечивают масштабируемость.

- **1 InfluxDB** (метрики):
    - **Логическое количество**: 1 кластер для временных рядов.
    - **Физическое количество**: для хайлоада нужен кластер с репликацией (например, 3 узла на ДЦ). С учетом 4 ДЦ:
        - 3 узла × 4 ДЦ = **12 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 1TB SSD.
    - **Обоснование**: InfluxDB используется для метрик, и 12 машин обеспечивают отказоустойчивость.

- **2 Grafana** (визуализация метрик):
    - **Логическое количество**: 2 инстанса для визуализации.
    - **Физическое количество**: для хайлоада достаточно 2 узла на ДЦ с резервированием. С учетом 4 ДЦ:
        - 2 узла × 4 ДЦ = **8 машин**.
        - **Конфигурация**: 8 ядер, 16 ГБ RAM, 500GB SSD.
    - **Обоснование**: Grafana легковесна, и 8 машин достаточно для отказоустойчивости.

- **11 Prometheus** (мониторинг):
    - **Логическое количество**: 11 инстансов, возможно, для разных микросервисов или зон.
    - **Физическое количество**: для хайлоада объединим в кластер с 5 узлами на ДЦ (для масштабируемости). С учетом 4 ДЦ:
        - 5 узлов × 4 ДЦ = **20 машин**.
        - **Конфигурация**: 16 ядер, 64 ГБ RAM, 1TB SSD.
    - **Обоснование**: Prometheus требует ресурсов для сбора метрик, и 20 машин обеспечивают высокую производительность.

### Итоговый список серверов
| **Тип**             | **Количество** | **Конфигурация**                 | **Провайдер** |
|---------------------|----------------|----------------------------------|---------------|
| Kubernetes-ноды     | 69             | 64 ядра, 256 ГБ RAM, 4TB NVMe    | Hetzner       |
| Nginx               | 40             | 16 ядер, 32 ГБ RAM               | Hetzner       |
| Redis (фронтенд)    | 20             | 16 ядер, 64 ГБ RAM, 1TB SSD      | AWS           |
| PostgreSQL          | 60             | 32 ядра, 128 ГБ RAM, 2TB SSD     | AWS           |
| ClickHouse          | 16             | 16 ядер, 64 ГБ RAM, 2TB SSD      | AWS           |
| Redis (бэкенд)      | 20             | 16 ядер, 64 ГБ RAM, 1TB SSD      | AWS           |
| Elasticsearch       | 12             | 16 ядер, 64 ГБ RAM, 2TB SSD      | AWS           |
| Amazon S3 (шлюзы)   | 12             | 16 ядер, 64 ГБ RAM, 2TB SSD      | AWS           |
| Kafka               | 28             | 32 ядра, 128 ГБ RAM, 2TB SSD     | Hetzner       |
| Splunk              | 12             | 16 ядер, 64 ГБ RAM, 2TB SSD      | AWS           |
| InfluxDB            | 12             | 16 ядер, 64 ГБ RAM, 1TB SSD      | AWS           |
| Grafana             | 8              | 8 ядер, 16 ГБ RAM, 500GB SSD     | AWS           |
| Prometheus          | 20             | 16 ядер, 64 ГБ RAM, 1TB SSD      | AWS           |

### Стоимость
- **Kubernetes-ноды (Hetzner)**: 69 × $500 = **$34,500/месяц**
- **Nginx (Hetzner)**: 40 × $200 = **$8,000/месяц**
- **Kafka (Hetzner)**: 28 × $500 = **$14,000/месяц**
- **AWS (PostgreSQL)**: 60 × $1,000 ≈ **$60,000/месяц** (оценка для 32 ядер)
- **AWS (Redis фронтенд)**: 20 × $500 ≈ **$10,000/месяц**
- **AWS (Redis бэкенд)**: 20 × $500 ≈ **$10,000/месяц**
- **AWS (ClickHouse)**: 16 × $500 ≈ **$8,000/месяц**
- **AWS (Elasticsearch)**: 12 × $500 ≈ **$6,000/месяц**
- **AWS (S3 шлюзы)**: 12 × $500 ≈ **$6,000/месяц**
- **AWS (Splunk)**: 12 × $500 ≈ **$6,000/месяц**
- **AWS (InfluxDB)**: 12 × $500 ≈ **$6,000/месяц**
- **AWS (Grafana)**: 8 × $200 ≈ **$1,600/месяц**
- **AWS (Prometheus)**: 20 × $500 ≈ **$10,000/месяц**
- **Итого**: $34,500 + $8,000 + $14,000 + $60,000 + $10,000 + $10,000 + $8,000 + $6,000 + $6,000 + $6,000 + $6,000 + $1,600 + $10,000 = **~$179,100/месяц**

---

## 12. Список источников <a name="список-источников"></a>

*Список литературы и источников, использованных при подготовке работы*

[^1]: Анализ трафика Ozon по данным SimilarWeb: [https://www.similarweb.com/ru/website/ozon.ru/#overview](https://www.similarweb.com/ru/website/ozon.ru/#overview)  
[^2]: Корпоративный сайт Ozon – пресс-релизы и финансовые отчёты с ключевыми метриками, включая MAU. [https://corp.ozon.ru/#rec535834970](https://corp.ozon.ru/#rec535834970)  
[^3]: Финансовый отчет Ozon за шесть месяцев, закончившихся 30 июня 2024 года: [https://ir.ozon.com/upload/iblock/f16/fto4qrjes1bfzyljqrym7aplxm24zune/Ozon_Report%20for%20the%20six%20months%20ended%20June%2030,%202024.pdf](https://ir.ozon.com/upload/iblock/f16/fto4qrjes1bfzyljqrym7aplxm24zune/Ozon_Report%20for%20the%20six%20months%20ended%20June%2030,%202024.pdf)  
[^4]: Финансовые результаты Ozon за 3 квартал 2024 года (отчет): [https://ir.ozon.com/upload/iblock/ba3/typisczp1lag8kx9nwt7u8g7pf0hczbh/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%203%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/ba3/typisczp1lag8kx9nwt7u8g7pf0hczbh/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%203%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^5]: Альтернативный финансовый отчет Ozon за 3 квартал 2024 года: [https://ir.ozon.com/upload/iblock/a45/fwnv4ob83rvkjso8nrk77s7v7lx74klb/Ozon_%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%203%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/a45/fwnv4ob83rvkjso8nrk77s7v7lx74klb/Ozon_%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%203%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^6]: Анализ динамики продавцов на маркетплейсах в 2024 году (Retail.ru): [https://www.retail.ru/news/v-2024-godu-zhenshchin-sellerov-na-marketpleysakh-stalo-bolshe-chem-muzhchin-11-marta-2024-238458/](https://www.retail.ru/news/v-2024-godu-zhenshchin-sellerov-na-marketpleysakh-stalo-bolshe-chem-muzhchin-11-marta-2024-238458/)  
[^7]: Финансовые результаты Ozon за первый квартал 2024 года: [https://ir.ozon.com/upload/iblock/830/9tjbv92pmnd5nbmxne100ukbjftqctlv/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D0%BF%D0%B5%D1%80%D0%B2%D1%8B%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/830/9tjbv92pmnd5nbmxne100ukbjftqctlv/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D0%BF%D0%B5%D1%80%D0%B2%D1%8B%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^8]: Пресс-релиз Ozon за 3 квартал 2024 года: [https://ir.ozon.com/upload/iblock/5bb/m22274yjqpunwfo26rhv035k4c2ef5ko/%D0%A3%D0%B2%D0%B5%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9%20%D1%80%D0%BE%D1%81%D1%82%20GMV%20%D0%B8%20%D1%80%D0%B5%D0%BA%D0%BE%D1%80%D0%B4%D0%BD%D0%B0%D1%8F%20%D1%81%D0%BA%D0%BE%D1%80%D1%80%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%B0%D1%8F%20EBITDA%20%D0%93%D1%80%D1%83%D0%BF%D0%BF%D1%8B%20%D0%B7%D0%B0%20%D1%82%D1%80%D0%B5%D1%82%D0%B8%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/5bb/m22274yjqpunwfo26rhv035k4c2ef5ko/%D0%A3%D0%B2%D0%B5%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9%20%D1%80%D0%BE%D1%81%D1%82%20GMV%20%D0%B8%20%D1%80%D0%B5%D0%BA%D0%BE%D1%80%D0%B4%D0%BD%D0%B0%D1%8F%20%D1%81%D0%BA%D0%BE%D1%80%D1%80%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%B0%D1%8F%20EBITDA%20%D0%93%D1%80%D1%83%D0%BF%D0%BF%D1%8B%20%D0%B7%D0%B0%20%D1%82%D1%80%D0%B5%D1%82%D0%B8%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^9]: Финансовые результаты Ozon за 2 квартал 2024 года (отчет): [https://ir.ozon.com/upload/iblock/826/q0nxzcjb05wiekpwt7udg9hjkdx3zvic/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%202%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/826/q0nxzcjb05wiekpwt7udg9hjkdx3zvic/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%202%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^10]: Финансовые результаты Ozon за 1 квартал 2024 года (отчет): [https://ir.ozon.com/upload/iblock/6e5/b8psyuctjtr33ltv2g4kdi4dfur1ltt7/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%201%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/6e5/b8psyuctjtr33ltv2g4kdi4dfur1ltt7/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%201%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202024%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^11]: Финансовые результаты Ozon за 2023 год (отчет): [https://ir.ozon.com/upload/iblock/f4b/97c0rkrg93pkjq754zfmqbkz9h6y31ve/Ozon%20-%20%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%202023%20%D0%B3%D0%BE%D0%B4.pdf](https://ir.ozon.com/upload/iblock/f4b/97c0rkrg93pkjq754zfmqbkz9h6y31ve/Ozon%20-%20%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%202023%20%D0%B3%D0%BE%D0%B4.pdf)  
[^12]: Финансовые результаты Ozon за 3 квартал 2023 года (отчет): [https://ir.ozon.com/upload/iblock/46e/r8se69b3gt1rtuohxjozflod2jc1qmlb/Ozon%20-%20%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%203%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023.pdf](https://ir.ozon.com/upload/iblock/46e/r8se69b3gt1rtuohxjozflod2jc1qmlb/Ozon%20-%20%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%203%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023.pdf)  
[^13]: Пресс-релиз Ozon за 3 квартал 2023 года: [https://ir.ozon.com/upload/iblock/504/8n9qs5m4qwm3gnj5r83zr19zol6f0r82/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D1%82%D1%80%D0%B5%D1%82%D0%B8%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023%20%D0%B3%D0%BE%D0%B4%D0%B0%20%D0%B8%20%D0%BF%D0%BE%D0%B2%D1%8B%D1%88%D0%B0%D0%B5%D1%82%20%D0%B3%D0%BE%D0%B4%D0%BE%D0%B2%D0%BE%D0%B9%20%D0%BF%D1%80%D0%BE%D0%B3%D0%BD%D0%BE%D0%B7%20%D0%BF%D0%BE%20%D0%BE%D0%B1%D0%BE%D1%80%D0%BE%D1%82%D1%83.pdf](https://ir.ozon.com/upload/iblock/504/8n9qs5m4qwm3gnj5r83zr19zol6f0r82/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D1%82%D1%80%D0%B5%D1%82%D0%B8%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023%20%D0%B3%D0%BE%D0%B4%D0%B0%20%D0%B8%20%D0%BF%D0%BE%D0%B2%D1%8B%D1%88%D0%B0%D0%B5%D1%82%20%D0%B3%D0%BE%D0%B4%D0%BE%D0%B2%D0%BE%D0%B9%20%D0%BF%D1%80%D0%BE%D0%B3%D0%BD%D0%BE%D0%B7%20%D0%BF%D0%BE%20%D0%BE%D0%B1%D0%BE%D1%80%D0%BE%D1%82%D1%83.pdf)  
[^14]: Финансовые результаты Ozon за 2 квартал 2023 года (отчет): [https://ir.ozon.com/upload/iblock/36a/uogdb308u07ehe23i8qml2voo0yz27k2/Q2%202023%20Ozon%20Financial%20Results.png](https://ir.ozon.com/upload/iblock/36a/uogdb308u07ehe23i8qml2voo0yz27k2/Q2%202023%20Ozon%20Financial%20Results.png)  
[^15]: Финансовые результаты Ozon за 1 квартал 2023 года (отчет): [https://ir.ozon.com/upload/iblock/576/1831ibqswiojt1kunne4pl74ceewm6v6/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%201%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023.jpg](https://ir.ozon.com/upload/iblock/576/1831ibqswiojt1kunne4pl74ceewm6v6/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20Ozon%20%D0%B7%D0%B0%201%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023.jpg)  
[^16]: Пресс-релиз Ozon за 1 квартал 2023 года: [https://ir.ozon.com/upload/iblock/4b2/s2s5rf9wgsy41dmlanu7k22516a64k7f/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D0%BD%D0%B5%D0%B0%D1%83%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D0%BF%D0%B5%D1%80%D0%B2%D1%8B%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf](https://ir.ozon.com/upload/iblock/4b2/s2s5rf9wgsy41dmlanu7k22516a64k7f/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D0%BD%D0%B5%D0%B0%D1%83%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D0%BF%D0%B5%D1%80%D0%B2%D1%8B%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202023%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf)  
[^17]: Более менее точный сайт оценки трафика: [https://pr-cy.ru/site-statistics/](https://pr-cy.ru/site-statistics/)  
[^18]: Страница для помощи новым продавцам Ozon: [https://seller.ozon.ru/](https://seller.ozon.ru/)  
[^19]: Анализ маркетплейсов от марта 2024-ого: [https://mediascope.net/upload/iblock/4fe/y85jka00l645h8f5qaw2zd52fhxrz4x3/Ecom%202024_Mediascope.pdf](https://mediascope.net/upload/iblock/4fe/y85jka00l645h8f5qaw2zd52fhxrz4x3/Ecom%202024_Mediascope.pdf)  
[^20]: Оценочная статья про использование поиска: [https://sberbusiness.live/publications/kak-pokupateli-ischut-tovar-na-marketpleisah-issledovanie-mediascope](https://sberbusiness.live/publications/kak-pokupateli-ischut-tovar-na-marketpleisah-issledovanie-mediascope)  
[^21]: Данные по продвижению товара EliteCat от e-promo: [https://www.e-promo.ru/upload/iblock/c0d/%D0%A1%D0%B0%D0%BC%D0%B8_%D1%81_%D1%83%D1%81%D0%B0%D0%BC%D0%B8_Case_E-Promo.pdf](https://www.e-promo.ru/upload/iblock/c0d/%D0%A1%D0%B0%D0%BC%D0%B8_%D1%81_%D1%83%D1%81%D0%B0%D0%BC%D0%B8_Case_E-Promo.pdf)  
[^22]: Половина россиян заходит на маркетплейсы ежедневно: [https://allo.tochka.com/news/ohvaty-mp](https://allo.tochka.com/news/ohvaty-mp)  
[^23]: Отзыв клиента – крик души! Работа с отзывами и ответами на маркетплейсах WB и Ozon:[https://vc.ru/marketplace/444782-otzyv-klienta-krik-dushi-rabota-s-otzyvami-i-otvetami-na-marketpleisah-wb-i-ozon?utm_source=chatgpt.com](https://vc.ru/marketplace/444782-otzyv-klienta-krik-dushi-rabota-s-otzyvami-i-otvetami-na-marketpleisah-wb-i-ozon?utm_source=chatgpt.com)  
[^24]: Финансовые результаты Ozon за 2 квартал 2022 года (отчет): [https://cdn1.ozone.ru/s3/sigma-static-e93b3ad2-6f0b-4ad0-a53e-192ad6466704/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D0%BD%D0%B5%D0%B0%D1%83%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D0%B2%D1%82%D0%BE%D1%80%D0%BE%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202022%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf?ts=1734627998204](https://cdn1.ozone.ru/s3/sigma-static-e93b3ad2-6f0b-4ad0-a53e-192ad6466704/Ozon%20%D0%BE%D0%B1%D1%8A%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%20%D0%BD%D0%B5%D0%B0%D1%83%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%84%D0%B8%D0%BD%D0%B0%D0%BD%D1%81%D0%BE%D0%B2%D1%8B%D0%B5%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%B7%D0%B0%20%D0%B2%D1%82%D0%BE%D1%80%D0%BE%D0%B9%20%D0%BA%D0%B2%D0%B0%D1%80%D1%82%D0%B0%D0%BB%202022%20%D0%B3%D0%BE%D0%B4%D0%B0.pdf?ts=1734627998204)  
[^25]: Телеграм чат с данными про Ozon: [https://t.me/ozonhq](https://t.me/ozonhq)  
[^26]: Годовой отчет ozon 2022: [https://www.sec.gov/ix?doc=/Archives/edgar/data/1822829/000119312523115002/d445088d20f.htm](https://www.sec.gov/ix?doc=/Archives/edgar/data/1822829/000119312523115002/d445088d20f.htm)
[^27]: Годовой отчет ozon 2023: [https://cdn1.ozone.ru/s3/sigma-static-e93b3ad2-6f0b-4ad0-a53e-192ad6466704/Ozon_Annual_Report_2023_RUS.pdf?ts=1734619098494](https://cdn1.ozone.ru/s3/sigma-static-e93b3ad2-6f0b-4ad0-a53e-192ad6466704/Ozon_Annual_Report_2023_RUS.pdf?ts=1734619098494)
[^28]: Сервера DNS по домену: [https://2domains.ru/whois/ozon.ru](https://2domains.ru/whois/ozon.ru)
[^29]: ip address и домены по DNS: [https://myip.ms/browse/dns/Sites_DNS_Nameservers](https://myip.ms/browse/dns/Sites_DNS_Nameservers)
[^30]: Карта заселенности России: [https://worldpopulationreview.com/countries/russia](https://worldpopulationreview.com/countries/russia)
[^31]: Карта покрытия сетью: [https://www.nperf.com/ru/map/RU/-/157254.MegaFon-Mobile/signal?ll=61.270232790000634&lg=95.70528339431657&zoom=3](https://www.nperf.com/ru/map/RU/-/157254.MegaFon-Mobile/signal?ll=61.270232790000634&lg=95.70528339431657&zoom=3)
[^32]: ЦОДы России: [https://alldc.ru/dcs/map/?city=33](https://alldc.ru/dcs/map/?city=33)
[^33]: Resources | Spring Boot on GCP: [https://spring-gcp.saturnism.me/deployment/kubernetes/resources](https://spring-gcp.saturnism.me/deployment/kubernetes/resources)
[^34]: Sizing Kubernetes pods for JVM apps without fearing the OOM Killer: [https://varoa.net/jvm/kubernetes/memory/docker/oomkiller/2019/05/29/k8s-and-java.html](https://varoa.net/jvm/kubernetes/memory/docker/oomkiller/2019/05/29/k8s-and-java.html)
